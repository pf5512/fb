<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8"><![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9"><![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>场地管理</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width">
<link rel="icon" href="../img/analysis/auf_title.png" type="image/x-icon"/>
<link rel="stylesheet" href="../css/fakeLoader.min.css">
<link rel="stylesheet" type="text/css" href="../css/justin_common.css">
<link rel="stylesheet" type="text/css" href="../css/button.min.css">
<link href="../css/jquery-ui.dialog.1.11.4.min.css" rel="stylesheet" type="text/css">

<script src="assets/javascripts/1.3.0/adminflare-demo-init.min.js" type="text/javascript"></script>
<script type="text/javascript">
	// Include Bootstrap stylesheet 
	document
			.write('<link href="assets/css/' + DEMO_ADMINFLARE_VERSION + '/' + DEMO_CURRENT_THEME + '/bootstrap.min.css" media="all" rel="stylesheet" type="text/css" id="bootstrap-css">');
	// Include AdminFlare stylesheet 
	document
			.write('<link href="assets/css/' + DEMO_ADMINFLARE_VERSION + '/' + DEMO_CURRENT_THEME + '/adminflare.min.css" media="all" rel="stylesheet" type="text/css" id="adminflare-css">');
</script>
<script src="assets/javascripts/1.3.0/modernizr-jquery.min.js" type="text/javascript"></script>
<script src="assets/javascripts/1.3.0/adminflare-demo.min.js" type="text/javascript"></script>
<script src="assets/javascripts/1.3.0/bootstrap.min.js" type="text/javascript"></script>
<script src="assets/javascripts/1.3.0/adminflare.min.js" type="text/javascript"></script>


<script src="assets/javascripts/vue.min.js" type="text/javascript"></script>
<script src="../js/jquery-1.11.2.min.js" type="text/javascript"></script>
<script src="../js/justin_common.js" type="text/javascript"></script>
<script src="../mobile/js/lib/underscore-min.js" type="text/javascript"></script>
<script src="../js/fakeLoader.min.js" type="text/javascript"></script>
<script src="../js/jquery-ui.dialog.1.11.4.min.js" type="text/javascript"></script>


<script type="text/javascript">
	$(document).ready(function() {
		prettyPrint();
	});
</script>
</head>
<body>
	<div id="fakeLoader" style="display:none;"></div>
	<script type="text/javascript">
		demoSetBodyLayout();
	</script>
	<!-- Main navigation bar  ================================================== -->
	
	
	<header class="navbar navbar-fixed-top" id="main-navbar">
		<div class="navbar-inner">
			<div class="container">
				<img id="arenaLogo" onerror="this.style.display='none'"  style="float: left;margin: 6px 0px 0px 5px;width: 28px;height: 28px;">
				<a class="logo"
					style="width: 200px;color: cornsilk; font-size: 15px;font-weight: bold; margin: 10px 8px 0px 8px;">Auf-Backend</a>
				<a class="btn nav-button collapsed" data-toggle="collapse"
					data-target=".nav-collapse"> <span class="icon-reorder"></span>
				</a>

				<div class="nav-collapse collapse">
					<ul class="nav">
						<li class="active">
							<a href="/footballer/backadmin/fieldReservation.html">预定</a></li>
						<li class="complete">
							<a href="/footballer/backadmin/battleMgmt.html" style="color: greenyellow;">约战</a></li>
						<li class="complete">
							<a href="/footballer/backadmin/soloMgmt.html" style="color: aqua;">单飞</a></li>
						<li class="divider-vertical"></li>
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown">管理<i class=" icon-caret-down"></i></a>
							<ul class="dropdown-menu">
								<li><a href="/footballer/backadmin/memberList.html">会员</a></li>
								<li><a href="/footballer/backadmin/nonmemberList.html">用户</a></li>
								<li><a href="/footballer/backadmin/fieldManagement.html">场次/价格</a></li>
								<li class="divider"></li>
								<li class="nav-header">高级功能</li>
								<li><a href="/footballer/backadmin/dataStatistics.html">数据统计</a></li>
								<li><a href="/footballer/backadmin/automationConfig.html">固定场次自动预定</a></li>
							</ul></li>
						<li class="divider-vertical"></li>
					</ul>
					<!-- <form class="navbar-search pull-left" action="" _lpchecked="1">
						<input type="text" class="search-query" placeholder="Search" style="width: 120px">
					</form> -->
					<ul class="nav pull-right">
						<li>
							<!-- <ul class="messages">
								<li><a href="#"><i class="icon-warning-sign"></i> 2<span class="responsive-text"> alerts</span></a></li>
								<li><a href="#"><i class="icon-envelope"></i> 25<span class="responsive-text"> new messages</span></a></li>
							</ul> -->
						</li>
						<li class="separator"></li>
						<li class="dropdown">
							<img onerror="this.style.display='none'" class="headIcon" src="../img/common/admin_spy.png" style="margin: 3px 0 0 1px;">
							<a href="#" class="dropdown-toggle usermenu" data-toggle="dropdown"> 
								<span id="adminName" style="width: 100px;display: block;">管理员名</span>
							</a>
							<ul class="dropdown-menu">
								<li><a onclick="updatePwdPopup();" href="#">修改密码</a></li>
								<!-- <li><a href="#">设置</a></li> -->
								<li class="divider"></li>
								<li><a onclick="loginOut();" href="/footballer/backadmin/fieldReservation.html" >登出</a></li>
							</ul>
					</ul>
				</div>
			</div>
		</div>
	</header>
	<!-- / Main navigation bar -->

	<div id="dialog-form" title="请先登陆"  style="display:none;">
		  <p class="validateTips"></p>
		 
		  <form>
		    <fieldset>
		      <div class="HBox">
		      	<label for="name">用户</label>
		      	<input type="text" name="name" id="name"  class="text ui-widget-content ui-corner-all">
		      </div>
		      <br>
		      <div class="HBox">
		      	<label for="password">密码</label>
		      	<input type="password" name="password" id="password"  class="text ui-widget-content ui-corner-all">
		      </div>
		      <!-- Allow form submission with keyboard without duplicating the dialog button -->
		      <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
		    </fieldset>
		  </form>
	</div>
	
	<div id="dialog-updatePwd" title="修改密码"  style="display:none;">
		  <p class="validateTips"></p>
		 
		  <form>
		    <fieldset>
		      <div class="HBox">
		      	<label for="newPwd" class="forInput">新密码</label>
		      	<input type="password" name="newPwd" id="newPwd"  class="text ui-widget-content ui-corner-all">
		      </div>
		      <br>
		      <div class="HBox">
		      	<label for="confirmPwd" class="forInput">确认密码</label>
		      	<input type="password" name="confirmPwd" id="confirmPwd"  class="text ui-widget-content ui-corner-all">
		      </div>
		      <!-- Allow form submission with keyboard without duplicating the dialog button -->
		      <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
		    </fieldset>
		  </form>
	</div>


	<section class="container" id="app">
	
		<section class="row-fluid">
			<h3 class="box-header">
				<img onerror="this.style.display='none'" class="headIcon" src="../img/common/field_logo1.png" style="margin: -7px 10px 0px 0px;">
				场地/场次
			</h3>
			
			<div class="box">
		<!--	<div class="HBox">
						 <button v-on:click="showAddField" id="addField" class="label label-green" style="height: 33px;">新增场次</button> 
				</div>
				
				<div class="box" id="fielinfo" style="display: none;">
					<table class="hover">
						<tr>
							<td><label class="forSelect">场地名</label></td>
							<td>
								<select  style="width:180px;margin-right: 10px;" v-on:change="selectFieldNameChange">
									<option value="0">请选择</option>
									<option v-for="op in uniqOptions" v-bind:value="op.id">
										<label class="outsetBlue">{{op.name}}</label>
									</option>
								</select>
							</td>
							<td><label class="forSelect">时段</label></td>
							<td>
								<input id="startTimeInput" type="time" v-on:change="dateChange" value="10:00" style="width:150px;">
								<input id="endTimeInput" type="time" v-on:change="dateChange" value="12:00" style="width:150px;">
							</td>
						</tr>	
					</table>
				</div> 
		-->
				<h4>
					<img onerror="this.style.display='none'" class="headIcon" src="../img/backend/fcs_set.png" style="margin: -7px 10px 0px 0px;">
					时间场次
				</h4>
		
				<table class="table table-hover">
						<thead>
							<tr>
								<th>开始时间</th>
								<th>结束时间</th>
								<th>操作</th>
							</tr>
						</thead>
						<tbody>
							<template v-for="row in displayingTimeShiftFCSList">
							<tr id="{{row.id}}" data-fieldId ="{{row.fieldId}}">
								<td>
									{{row.disPlayStartTime}}	
								</td>
								<td>
									{{row.disPlayEndTime}}	
								</td>
								<td>
									<a id="{{row.id}}" v-on:click="editBtn" class="button button-primary button-rounded button-tiny">编辑</a>
								</td>
							</tr>
							<tr id="{{row.id}}" data-fieldId ="{{row.fieldId}}" style="display:none;">
								<td>
									<input id="startTimeInput" type="time" v-on:change="dateChange" value="{{row.disPlayStartTime}}" style="width:150px;">	
								</td>
								<td>
									<input id="endTimeInput" type="time" v-on:change="dateChange" value="{{row.disPlayEndTime}}" style="width:150px;">	
								</td>
								
								<td>
									<a id="{{row.id}}" v-on:click="backBtn" class="button button-highlight button-rounded button-tiny">返回</a>
									<a id="{{row.id}}" v-on:click="saveTimeShiftBtn" class="button button-action button-rounded button-tiny">更新</a>
								</td>
							</tr>
							</template>
						</tbody>
					</table>
		
				<br></br>
		
				<h4>
					<img onerror="this.style.display='none'" class="headIcon" src="../img/backend/rmb_50.png" style="margin: -7px 10px 0px 0px;">
					价格设置
				</h4>
				
				<table class="table table-hover">
						<thead>
							<tr>
								<th style="width:200px;">
									<select  style="width:180px;margin-bottom: 0px;" v-on:change="selectFieldNameChange">
									<option value="0">所有</option>
									<option v-for="op in uniqOptions" v-bind:value="op.id">
										<label class="outsetBlue">{{op.name}}</label>
									</option>
								</select>
									
								</th>
								<th>开始时间</th>
								<th>结束时间</th>
								<th>价格</th>
								<th>周末价格</th>
								<th>操作</th>
							</tr>
						</thead>
						<tbody>
							<template v-for="row in displayingFCSList">
							<tr id="{{row.id}}" data-fieldId ="{{row.fieldId}}">
								<td>{{row.name}}</td>
								<td>
									{{row.disPlayStartTime}}	
								</td>
								<td>
									{{row.disPlayEndTime}}	
								</td>
								<td>{{row.price}}</td>
								<td>{{row.weekendPrice}}</td>
								<td>
									<a id="{{row.id}}" v-on:click="editBtn" class="button button-primary button-rounded button-tiny">编辑</a>
								</td>
							</tr>
							<tr id="{{row.id}}" data-fieldId ="{{row.fieldId}}" style="display:none;">
								<td>{{row.name}}</td>
								<td>
									{{row.disPlayStartTime}}	
								</td>
								<td>
									{{row.disPlayEndTime}}	
								</td>
								<td>
									<input type="number" style="width:150px;"  value="{{row.price}}">
								</td>
								
								<td>
									<input type="number" style="width:150px;"  value="{{row.weekendPrice}}">
								</td>
								
								<td>
									<a id="{{row.id}}" v-on:click="backBtn" class="button button-highlight button-rounded button-tiny">返回</a>
									<a id="{{row.id}}" v-on:click="savePriceBtn" class="button button-action button-rounded button-tiny">更新</a>
								</td>
							</tr>
							</template>
						</tbody>
					</table>
			</div>
		</section>


		<!-- Page footer ================================================== -->
		
		<footer id="main-footer">
			Copyright © 2015 <!-- <a href="http://www.footballer.cc"> -->成都傲赴体育有限公司 
			all rights reserved. <a href="#" class="pull-right" id="on-top-link">
				On Top &nbsp;<i class="icon-chevron-up"></i>
			</a>
		</footer>		<!-- / Page footer -->
	</section>
</body>
<script type="text/javascript">
	(function() {
		var host;
		var arenaId;
		var urlPre ='',iaa='';
		
		var vm = new Vue(
				{
					el : '#app',
					data : {
						fieldChargeStandardList:[],
						displayingFCSList:[],
						displayingTimeShiftFCSList:[],
						uniqOptions:[],
						currentEditStartTime:null,
						currentEditEndTime:null
					},
					watch : {},
					methods : {
						init:function(){
							arenaId = window.localStorage["arenaId"]
							urlPre = window.localStorage["urlPre"]
					 		iaa = window.localStorage["iaa"]
						},
						getFieldList : function() {
							loading();	 
 							url = urlPre+'arenaField-service/getArenaFieldsStandards/'+ arenaId + iaa
 							
							 $.GetJSON(url, null,function(data) {
								if (data) {
									vm.$data.fieldChargeStandardList = data.fieldChargeStandardList;
									vm.$data.displayingFCSList = vm.$data.fieldChargeStandardList
									
									var selectOptions = []
									$.each(vm.$data.fieldChargeStandardList, function(i,v){
										var option = {}
										option.id = v.fieldId
										option.name = v.name
										selectOptions.push(option)
									})
									
									//uniquearr(selectOptions)
									vm.$data.uniqOptions = _.uniq(selectOptions, function(obj) { return obj.id; });
									hideLoading();
									
									vm.$data.displayingTimeShiftFCSList  = _.where(vm.$data.fieldChargeStandardList, {fieldId: vm.$data.fieldChargeStandardList[0].fieldId});
								}
							});     
							
							//测试数据
							/* var testData ={"status":"success","message":null,"fieldChargeStandard":null,"fieldChargeStandardList":[{"id":1,"arenaId":52,"fieldId":36,"startTime":7200000,"endTime":14400000,"disPlayStartTime":"10:00","disPlayEndTime":"12:00","price":200,"barginPrice":100,"name":"1号球场"},{"id":2,"arenaId":52,"fieldId":36,"startTime":14400000,"endTime":21600000,"disPlayStartTime":"12:00","disPlayEndTime":"14:00","price":200,"barginPrice":100,"name":"1号球场"},{"id":3,"arenaId":52,"fieldId":36,"startTime":21600000,"endTime":28800000,"disPlayStartTime":"14:00","disPlayEndTime":"16:00","price":200,"barginPrice":100,"name":"1号球场"},{"id":4,"arenaId":52,"fieldId":36,"startTime":28800000,"endTime":36000000,"disPlayStartTime":"16:00","disPlayEndTime":"18:00","price":200,"barginPrice":100,"name":"1号球场"},{"id":5,"arenaId":52,"fieldId":36,"startTime":36000000,"endTime":41400000,"disPlayStartTime":"18:00","disPlayEndTime":"19:30","price":300,"barginPrice":200,"name":"1号球场"},{"id":6,"arenaId":52,"fieldId":36,"startTime":41400000,"endTime":46800000,"disPlayStartTime":"19:30","disPlayEndTime":"21:00","price":300,"barginPrice":200,"name":"1号球场"},{"id":7,"arenaId":52,"fieldId":36,"startTime":46800000,"endTime":52200000,"disPlayStartTime":"21:00","disPlayEndTime":"22:30","price":300,"barginPrice":200,"name":"1号球场"},{"id":18,"arenaId":52,"fieldId":37,"startTime":7200000,"endTime":14400000,"disPlayStartTime":"10:00","disPlayEndTime":"12:00","price":200,"barginPrice":100,"name":"2号球场"},{"id":22,"arenaId":52,"fieldId":37,"startTime":14400000,"endTime":21600000,"disPlayStartTime":"12:00","disPlayEndTime":"14:00","price":200,"barginPrice":100,"name":"2号球场"},{"id":23,"arenaId":52,"fieldId":37,"startTime":21600000,"endTime":28800000,"disPlayStartTime":"14:00","disPlayEndTime":"16:00","price":200,"barginPrice":100,"name":"2号球场"},{"id":24,"arenaId":52,"fieldId":37,"startTime":28800000,"endTime":36000000,"disPlayStartTime":"16:00","disPlayEndTime":"18:00","price":200,"barginPrice":100,"name":"2号球场"},{"id":25,"arenaId":52,"fieldId":37,"startTime":36000000,"endTime":41400000,"disPlayStartTime":"18:00","disPlayEndTime":"19:30","price":300,"barginPrice":200,"name":"2号球场"},{"id":26,"arenaId":52,"fieldId":37,"startTime":41400000,"endTime":46800000,"disPlayStartTime":"19:30","disPlayEndTime":"21:00","price":300,"barginPrice":200,"name":"2号球场"},{"id":27,"arenaId":52,"fieldId":37,"startTime":46800000,"endTime":52200000,"disPlayStartTime":"21:00","disPlayEndTime":"22:30","price":300,"barginPrice":200,"name":"2号球场"},{"id":30,"arenaId":52,"fieldId":38,"startTime":7200000,"endTime":14400000,"disPlayStartTime":"10:00","disPlayEndTime":"12:00","price":200,"barginPrice":200,"name":"3号球场"},{"id":31,"arenaId":52,"fieldId":38,"startTime":14400000,"endTime":21600000,"disPlayStartTime":"12:00","disPlayEndTime":"14:00","price":300,"barginPrice":200,"name":"3号球场"},{"id":32,"arenaId":52,"fieldId":38,"startTime":21600000,"endTime":28800000,"disPlayStartTime":"14:00","disPlayEndTime":"16:00","price":300,"barginPrice":200,"name":"3号球场"},{"id":34,"arenaId":52,"fieldId":38,"startTime":28800000,"endTime":36000000,"disPlayStartTime":"16:00","disPlayEndTime":"18:00","price":200,"barginPrice":100,"name":"3号球场"},{"id":35,"arenaId":52,"fieldId":38,"startTime":36000000,"endTime":41400000,"disPlayStartTime":"18:00","disPlayEndTime":"19:30","price":300,"barginPrice":200,"name":"3号球场"},{"id":36,"arenaId":52,"fieldId":38,"startTime":41400000,"endTime":46800000,"disPlayStartTime":"19:30","disPlayEndTime":"21:00","price":300,"barginPrice":200,"name":"3号球场"},{"id":37,"arenaId":52,"fieldId":38,"startTime":46800000,"endTime":52200000,"disPlayStartTime":"21:00","disPlayEndTime":"22:30","price":300,"barginPrice":200,"name":"3号球场"},{"id":38,"arenaId":52,"fieldId":39,"startTime":7200000,"endTime":14400000,"disPlayStartTime":"10:00","disPlayEndTime":"12:00","price":300,"barginPrice":200,"name":"4号球场"},{"id":39,"arenaId":52,"fieldId":39,"startTime":14400000,"endTime":21600000,"disPlayStartTime":"12:00","disPlayEndTime":"14:00","price":300,"barginPrice":200,"name":"4号球场"},{"id":40,"arenaId":52,"fieldId":39,"startTime":21600000,"endTime":28800000,"disPlayStartTime":"14:00","disPlayEndTime":"16:00","price":300,"barginPrice":200,"name":"4号球场"},{"id":41,"arenaId":52,"fieldId":39,"startTime":28800000,"endTime":36000000,"disPlayStartTime":"16:00","disPlayEndTime":"18:00","price":200,"barginPrice":100,"name":"4号球场"},{"id":42,"arenaId":52,"fieldId":39,"startTime":36000000,"endTime":41400000,"disPlayStartTime":"18:00","disPlayEndTime":"19:30","price":300,"barginPrice":200,"name":"4号球场"},{"id":43,"arenaId":52,"fieldId":39,"startTime":41400000,"endTime":46800000,"disPlayStartTime":"19:30","disPlayEndTime":"21:00","price":300,"barginPrice":200,"name":"4号球场"},{"id":44,"arenaId":52,"fieldId":39,"startTime":46800000,"endTime":52200000,"disPlayStartTime":"21:00","disPlayEndTime":"22:30","price":300,"barginPrice":200,"name":"4号球场"}]}
							vm.$data.fieldChargeStandardList = testData.fieldChargeStandardList; 
							vm.$data.displayingFCSList = vm.$data.fieldChargeStandardList
							
							var selectOptions = []
							$.each(vm.$data.fieldChargeStandardList, function(i,v){
								var option = {}
								option.id = v.fieldId
								option.name = v.name
								selectOptions.push(option)
							})
							
							//uniquearr(selectOptions)
							vm.$data.uniqOptions = _.uniq(selectOptions, function(obj) { return obj.id; }); */
							
						},
						selectFieldNameChange:function(e){
							var selectedFieldId =Number(e.target.value)
							if(selectedFieldId == 0){
								vm.$data.displayingFCSList = vm.$data.fieldChargeStandardList						
							}else{
								vm.$data.displayingFCSList  = _.where(vm.$data.fieldChargeStandardList, {fieldId: selectedFieldId});	
							}
						},
						showAddField:function(){
							$('#fielinfo').toggle();
						},
						editBtn:function(e){
							$(e.target).parents('tr').hide()
							$(e.target).parents('tr').next().show()
							
							vm.currentEditStartTime = $(e.target).parents('tr').find('td').eq(0).text().trim()
							vm.currentEditEndTime = $(e.target).parents('tr').find('td').eq(1).text().trim()
						},
						backBtn:function(e){
							$(e.target).parents('tr').hide()
							$(e.target).parents('tr').prev().show()
						},
						saveTimeShiftBtn:function(e){
							endTime = $(e.target).parents('td').prev().find('input').val().trim()
							startTime = $(e.target).parents('td').prev().prev().find('input').val().trim()
							fcsId = Number($(e.target).parents('tr').attr('id'))
							fieldId = Number($(e.target).parents('tr').attr('data-fieldId'))
							
							if(vm.timeShiftValidate(fcsId,fieldId,startTime,endTime)){
								$(e.target).parent().find('a').hide()
								$(e.target).parents('tr').find('input').attr("disabled",true)
								$(e.target).parent().append('<img style="margin: 0px 0px 0px 5px;width: 30px;height: 30px;" src="../img/gif/soccer_loading.gif">')
								
								saveFCSPostUrl = urlPre+'arenaField-service/updateSameTimeShiftArenaFieldStandard'+iaa
								var parameter = {
										arenaId: arenaId,
										id : fcsId,
										startTime : startTime,
										endTime: endTime
									};
								
								$.putJSON(saveFCSPostUrl, parameter, e, function(data) {
									if(data.status == 'success'){
										
										//同步到页面时间段列表
										$.each(vm.$data.displayingTimeShiftFCSList, function(i,v){
											if(v.id == fcsId){
												v.disPlayStartTime = startTime
												v.disPlayEndTime = endTime
												return false
											}
										} ) 
										
										//同步到页面时间及价格列表
										$.each(vm.$data.fieldChargeStandardList, function(i,v){
											if(v.disPlayStartTime == vm.currentEditStartTime && v.disPlayEndTime == vm.currentEditEndTime){
												v.disPlayStartTime = startTime
												v.disPlayEndTime = endTime
											}
										} ) 
										
										$(e.target).parent().find('a').toggle()
										$(e.target).parents('tr').find('input').attr("disabled",false)
										$(e.target).parent().find('img').remove()
										
										//触发自动返回
										$(e.target.previousElementSibling).parents('tr').hide();
										$(e.target.previousElementSibling).parents('tr').prev().show()
									}else{
										alert('保存失败，请检查输入参数是否合理');	
									}	
									
								});	
							}else{
								//alert('输入有误，请检查输入参数是否合理');
							}
						},
						timeShiftValidate:function(fcsId,fieldId,startTime,endTime){
							if(fcsId == null || fcsId == '' || fcsId == void 0){
								alert('获取数据失败');
								return false
							}
							
							var flag = true;
							currentStartTimeDate = StringHMTimeToDateNumber(startTime)
							currentEndTimeDate = StringHMTimeToDateNumber(endTime)
							
							//结束时间必须大于开始时间
							if(currentStartTimeDate - currentEndTimeDate >= 0){
								alert('结束时间必须在开始时间之后');
								return false
							}
							
							//同场地时间范围检查
							var currentCompareFieldListWithOutItself = _.reject(_.where(vm.$data.fieldChargeStandardList, {fieldId: fieldId}), function(item){ return item.id == fcsId; })
							$.each(currentCompareFieldListWithOutItself,function(i,v){
								if(timeInTimeShiftCheck(currentStartTimeDate, StringHMTimeToDateNumber(v.disPlayStartTime), StringHMTimeToDateNumber(v.disPlayEndTime))
									|| timeInTimeShiftCheck(currentEndTimeDate, StringHMTimeToDateNumber(v.disPlayStartTime), StringHMTimeToDateNumber(v.disPlayEndTime))	){
									//存在和当前时间段冲突，需要处理
									alert('当前修改时段'+ startTime+'-'+endTime+'与 '+ v.disPlayStartTime+ '-' + v.disPlayEndTime + '存在时间冲突,建议从当前场地最晚时段开始，逆向修改')
									flag = false	
									return false
								}
							})
							
							return flag
						},
						savePriceBtn:function(e){
							price = $(e.target).parents('td').prev().prev().find('input').val().trim()
							weekendPrice = $(e.target).parents('td').prev().find('input').val().trim()
							fcsId = Number($(e.target).parents('tr').attr('id'))
							fieldId = Number($(e.target).parents('tr').attr('data-fieldId'))
							
							if(vm.priceValidate(fcsId,fieldId,price,weekendPrice)){
								$(e.target).parent().find('a').hide()
								$(e.target).parents('tr').find('input').attr("disabled",true)
								$(e.target).parent().append('<img style="margin: 0px 0px 0px 5px;width: 30px;height: 30px;" src="../img/gif/soccer_loading.gif">')
								
								saveFCSPostUrl = urlPre+'arenaField-service/updateArenaFieldStandardPriceByFCSId'+iaa
								var parameter = {
										id : fcsId,
										price: price,
										weekendPrice: weekendPrice
									};

								
								$.putJSON(saveFCSPostUrl, parameter, e, function(data) {
									if(data.status == 'success'){
										
										$.each(vm.$data.fieldChargeStandardList, function(i,v){
											if(v.id == fcsId){
												v.price = price
												v.weekendPrice = weekendPrice
												return false
											}
										} ) 
										
										$(e.target).parent().find('a').toggle()
										$(e.target).parents('tr').find('input').attr("disabled",false)
										$(e.target).parent().find('img').remove()
										
										//触发自动返回
										$(e.target.previousElementSibling).parents('tr').hide();
										$(e.target.previousElementSibling).parents('tr').prev().show()
									}else{
										alert('保存失败，请检查输入参数是否合理');	
									}	
									
								});	
							}else{
							}
						},
						priceValidate : function(fcsId,fieldId,price,weekednPrice){
							if(fcsId == null || fcsId == '' || fcsId == void 0){
								alert('获取数据失败');
								return false
							}
							if(price ==null || price =='' || price ==void 0){
								alert('获取价格数据失败,不能为空值');
								return false
							}
							if(weekednPrice ==null || weekednPrice =='' || weekednPrice ==void 0){
								alert('获取周末价格数据失败,不能为空值');
								return false
							}
							else if(price <= 0 || weekednPrice <=0){
								alert('价格必须大于0');
								return false
							}else{
								return true;
							}
						}
					}
				});
 		
 		loginStatusCheck(pageInit);
 
		function pageInit(){
			loadingInit();
			vm.init()
			vm.getFieldList();
		}

	})()
</script>
</html>