<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8"><![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9"><![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>常用客户名单</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width">
<link rel="icon" href="../img/analysis/auf_title.png" type="image/x-icon"/>
<link rel="stylesheet" href="../css/fakeLoader.min.css">
<link rel="stylesheet" type="text/css" href="../css/button.min.css">
<link rel="stylesheet" type="text/css" href="../css/justin_common.css">
<link href="../css/jquery-ui.dialog.1.11.4.min.css" rel="stylesheet" type="text/css">

<script src="assets/javascripts/1.3.0/adminflare-demo-init.min.js"
	type="text/javascript"></script>

<script type="text/javascript">
	// Include Bootstrap stylesheet 
	document
			.write('<link href="assets/css/' + DEMO_ADMINFLARE_VERSION + '/' + DEMO_CURRENT_THEME + '/bootstrap.min.css" media="all" rel="stylesheet" type="text/css" id="bootstrap-css">');
	// Include AdminFlare stylesheet 
	document
			.write('<link href="assets/css/' + DEMO_ADMINFLARE_VERSION + '/' + DEMO_CURRENT_THEME + '/adminflare.min.css" media="all" rel="stylesheet" type="text/css" id="adminflare-css">');
</script>

<script src="assets/javascripts/1.3.0/modernizr-jquery.min.js"
	type="text/javascript"></script>
<script src="assets/javascripts/1.3.0/adminflare-demo.min.js"
	type="text/javascript"></script>
<script src="assets/javascripts/1.3.0/bootstrap.min.js"
	type="text/javascript"></script>
<script src="assets/javascripts/1.3.0/adminflare.min.js"
	type="text/javascript"></script>
<script src="assets/javascripts/vue.min.js" type="text/javascript"></script>
<script src="../js/jquery-1.11.2.min.js" type="text/javascript"></script>
<script src="../js/justin_common.js" type="text/javascript"></script>
<script src="../mobile/js/lib/underscore-min.js" type="text/javascript"></script>
<script src="../js/fakeLoader.min.js" type="text/javascript"></script>
<script src="../js/jquery-ui.dialog.1.11.4.min.js" type="text/javascript"></script>

<style type="text/css">
.well, .box {
	padding-bottom: 0;
}
</style>

<script type="text/javascript">
	$(document).ready(function() {
		prettyPrint();
	});
</script>
</head>
<body>
	<div id="fakeLoader"></div>
	<script type="text/javascript">
		demoSetBodyLayout();
	</script>
	<!-- Main navigation bar
		================================================== -->
	<header class="navbar navbar-fixed-top" id="main-navbar">
		<div class="navbar-inner">
			<div class="container">
				<img id="arenaLogo" onerror="this.style.display='none'"  style="float: left;margin: 6px 0px 0px 5px;width: 28px;height: 28px;">
				<a class="logo"
					style="width: 200px;color: cornsilk; font-size: 15px;font-weight: bold; margin: 10px 8px 0px 8px;">Auf-Backend</a>
				<a class="btn nav-button collapsed" data-toggle="collapse"
					data-target=".nav-collapse"> <span class="icon-reorder"></span>
				</a>

				<div class="nav-collapse collapse">
					<ul class="nav">
						<li class="active">
							<a href="/footballer/backadmin/fieldReservation.html">预定</a></li>
						<li class="complete">
							<a href="/footballer/backadmin/battleMgmt.html" style="color: greenyellow;">约战</a></li>
						<li class="complete">
							<a href="/footballer/backadmin/soloMgmt.html" style="color: aqua;">单飞</a></li>
						<li class="divider-vertical"></li>
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown">管理<i class=" icon-caret-down"></i></a>
							<ul class="dropdown-menu">
								<li><a href="/footballer/backadmin/memberList.html">会员</a></li>
								<li><a href="/footballer/backadmin/nonmemberList.html">用户</a></li>
								<li><a href="/footballer/backadmin/fieldManagement.html">场次/价格</a></li>
								<li class="divider"></li>
								<li class="nav-header">高级功能</li>
								<li><a href="/footballer/backadmin/dataStatistics.html">数据统计</a></li>
								<li><a href="/footballer/backadmin/automationConfig.html">固定场次自动预定</a></li>
							</ul></li>
						<li class="divider-vertical"></li>
					</ul>
					<!-- <form class="navbar-search pull-left" action="" _lpchecked="1">
						<input type="text" class="search-query" placeholder="Search" style="width: 120px">
					</form> -->
					<ul class="nav pull-right">
						<li>
							<!-- <ul class="messages">
								<li><a href="#"><i class="icon-warning-sign"></i> 2<span class="responsive-text"> alerts</span></a></li>
								<li><a href="#"><i class="icon-envelope"></i> 25<span class="responsive-text"> new messages</span></a></li>
							</ul> -->
						</li>
						<li class="separator"></li>
						<li class="dropdown">
							<img onerror="this.style.display='none'" class="headIcon" src="../img/common/admin_spy.png" style="margin: 3px 0 0 1px;">
							<a href="#" class="dropdown-toggle usermenu" data-toggle="dropdown"> 
								<span id="adminName" style="width: 100px;display: block;">管理员名</span>
							</a>
							<ul class="dropdown-menu">
								<li><a onclick="updatePwdPopup();" href="#">修改密码</a></li>
								<!-- <li><a href="#">设置</a></li> -->
								<li class="divider"></li>
								<li><a onclick="loginOut();" href="/footballer/backadmin/fieldReservation.html" >登出</a></li>
							</ul>
					</ul>
				</div>
			</div>
		</div>
	</header>
	
	<div id="dialog-form" title="请先登陆"  style="display:none;">
		  <p class="validateTips"></p>
		 
		  <form>
		    <fieldset>
		      <div class="HBox">
		      	<label for="name">用户</label>
		      	<input type="text" name="name" id="name"  class="text ui-widget-content ui-corner-all">
		      </div>
		      <br>
		      <div class="HBox">
		      	<label for="password">密码</label>
		      	<input type="password" name="password" id="password"  class="text ui-widget-content ui-corner-all">
		      </div>
		      <!-- Allow form submission with keyboard without duplicating the dialog button -->
		      <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
		    </fieldset>
		  </form>
	</div>
	
	<div id="dialog-updatePwd" title="修改密码"  style="display:none;">
		  <p class="validateTips"></p>
		 
		  <form>
		    <fieldset>
		      <div class="HBox">
		      	<label for="newPwd" class="forInput">新密码</label>
		      	<input type="password" name="newPwd" id="newPwd"  class="text ui-widget-content ui-corner-all">
		      </div>
		      <br>
		      <div class="HBox">
		      	<label for="confirmPwd" class="forInput">确认密码</label>
		      	<input type="password" name="confirmPwd" id="confirmPwd"  class="text ui-widget-content ui-corner-all">
		      </div>
		      <!-- Allow form submission with keyboard without duplicating the dialog button -->
		      <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
		    </fieldset>
		  </form>
	</div>

	<section class="container" id="app">

		<section class="row-fluid">
			<h3 class="box-header">常用客户名单</h3>
			<div class="box">

				<div class="span11">
					
				
					<div class="HBox">
						<img onerror="this.style.display='none'" class="headIcon" src="../img/common/userIcon.png" style="margin-right: 10px;">
						<label style="color: cornflowerblue;font-size: 22.75px; margin-top: 7px;margin-right: 10px;">后台用户</label>
						<button v-on:click="showAddMember" id="addMember" class="label label-green" style="height: 25px;margin-top: 5px;">新增常用客户</button>
					</div>
					<div class="box" id="memberinfo" style="display: none;">
						<div class="span11">
							<table class="hover">
								<tbody>
									<tr>
										<td>
											<p>姓名</p>
										</td>
										<td><input id="userNameInput" v-model="name" type="text"
											style="width: 120px"></td>
											
										<td style="padding-left: 20px;">
											<p>队名</p>
										</td>
										<td><input id="teamNameInput" v-model="teamName" type="text"
											style="width: 120px"></td>	

										<td style="padding-left: 20px;">
											<p>电话</p>
										</td>
										<td><input id="cellPhoneInput" v-model="cellPhone" type="tel" maxlength="11"
											style="width: 120px"></td>

										<td style="padding-left: 20px;">
											<p>微信号</p>
										</td>
										<td><input id="weChatInput" v-model="weChat" type="text"
											style="width: 120px"></td>
										
									</tr>
									<tr>
										<td><p>备注信息</p></td>
										<td colspan="8"><textarea rows="" cols="" style="margin: 0px 0px 10px; width: 683px; height: 66px;" v-model="comments"></textarea></td>
									</tr>

									<tr>
										<td></td>
									</tr>
									<tr>
										<td>
											<button v-on:click="cancelBtn" class="label label-red"
												style="width: 60px;">取消</button>
										</td>
										<td>
											<button id="saveBtn" v-on:click="saveBtn" class="label label-green"
												style="width: 60px;">保存</button>

											<button id="updateBtn" v-on:click="updateBtn" class="label label-green"
												style="width: 60px;display:none;">更新</button>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
					
					<table class="table table-hover">
						<thead>
							<tr>
								<th>#</th>
								<th></th>
								<th style="width:80px;font-weight: bolder;">姓名</th>
								<th style="width:110px;">队名</th>
								<th style="width:80px;">手机号</th>
								<!-- <th style="width:80px;">微信号</th> -->
								<th style="width:300px;">备注</th>
								<th>订场数</th>
								<th v-on:click="sortByDate" style="cursor:pointer;display:none;">加入时间</th>
								<!-- <th>自定价格</th> -->
								<th style="">操作</th>
							</tr>
						</thead>
						<tbody>
							<template v-for="row in backendUserList">
							<tr data-id="{{row.playerId}}">
								<td>{{$index+1}}</td>
								<td></td>
								<td>{{row.name}}</td>
								<td>{{row.teams}}</td>
								<td>{{row.cellphone}}</td>
								<!-- <td>{{row.wechatNo}}</td> -->
								<td>
									<div style="word-break: break-all;width: 300px;">
										{{row.comments}}
									</div>
								</td>
								<td>
									<a id="{{row.playerId}}" v-on:click="reservationDetail" class="button button-glow button-border button-rounded button-tiny">{{row.totalCount}}</a>	
								</td>
								<!-- <td>{{row.customPrice}}</td> -->
								<!-- <td>{{row.createDt.substr(0,10)}}</td> -->		  
								<td>
									<a id="{{row.id}}" v-on:click="editBtn" class="button button-primary button-rounded button-tiny" style="">编辑</a>
								</td>
							</tr>
							</template>
						</tbody>
					</table>
					<br></br>
					
					<div class="HBox">
						<img onerror="this.style.display='none'" class="headIcon" src="../img/common/wechatUser.png" style="margin-right: 10px;">
						<label style="color:green;font-size: 22.75px;margin-top: 7px;margin-right: 10px;">微信用户</label>
					</div>
					<table class="table table-hover">
						<thead>
							<tr>
								<th>#</th>
								<th style="width:35px;">头像</th>
								<th style="width:80px;font-weight: bolder;">姓名</th>
								<th style="width:110px;">队名</th>
								<th style="width:80px;">手机号</th>
								<!-- <th style="width:80px;">微信号</th> -->
								<th style="width:300px;">备注</th>
								<th>订场数</th>
								<th v-on:click="sortByDate" style="cursor:pointer;display:none;">加入时间</th>
								<!-- <th>自定价格</th> -->
								<th style="">操作</th>
							</tr>
						</thead>
						<tbody>
							<template v-for="row in wechatUserList">
							<tr data-id="{{row.playerId}}">
								<td>{{$index+1}}</td>
								<td>
									<img v-if="row.imgUrl != null" onerror="this.style.display='none'" class="headIcon" src="{{row.imgUrl}}">
								</td>
								<td>{{row.name}}</td>
								<td>{{row.teams}}</td>
								<td>{{row.cellphone}}</td>
								<!-- <td>{{row.wechatNo}}</td> -->
								<td>
									<div style="word-break: break-all;width: 300px;">
										{{row.comments}}
									</div>
								</td>
								<td>
									<a id="{{row.playerId}}" v-on:click="reservationDetail" class="button button-glow button-border button-rounded button-tiny">{{row.totalCount}}</a>	
								</td>
								<!-- <td>{{row.customPrice}}</td> -->
								<!-- <td>{{row.createDt.substr(0,10)}}</td> -->		  
								<td>
									<a id="{{row.id}}" v-on:click="editBtn" class="button button-primary button-rounded button-tiny" style="">编辑</a>
								</td>
							</tr>
							</template>
						</tbody>
					</table>
				</div>
			</div>
		</section>
		
		<section id="reservationInfo" class="row-fluid" style="display: none;">
			<h3 class="box-header">订场详情</h3>
			<div class="box">
				<table class="table table-hover">
					<thead>
						<tr>
							<th>#</th>
							<th>使用日期</th>
							<th>开始时间</th>
							<th>结束时间</th>
							<th>球场</th>
							<th>类型</th>
							<th>金额</th>
							<th>订场时间</th>
							<th>取消时间</th>
						</tr>
					</thead>
					<tbody>
						<template v-for="row in reservationList">
						<tr v-if="row.cancelDate" style="color:gray;text-decoration:line-through;">
								<td>{{$index+1}}</td>
								<td>{{row.useDate}}</td>
								<td>{{row.startTime}}</td>
								<td>{{row.endTime}}</td>
								<td>{{row.fieldName}}</td>
								<td>{{row.type}}</td>
								<td v-if="row.type == 'battle'">{{(row.price)/2}}</td>
								<td v-if="row.type == 'fullField'">{{row.price}}</td>
								<td>{{row.bookDate}}</td>
								<td>{{row.cancelDate}}</td>
						</tr>
						
						<tr v-if="row.cancelDate == null" style="color: cadetblue;">
								<td>{{$index+1}}</td>
								<td>{{row.useDate}}</td>
								<td>{{row.startTime}}</td>
								<td>{{row.endTime}}</td>
								<td>{{row.fieldName}}</td>
								<td>{{row.type}}</td>
								<td v-if="row.type == 'battle'">{{(row.price)/2}}</td>
								<td v-if="row.type == 'fullField'">{{row.price}}</td>
								<td>{{row.bookDate}}</td>
								<td>{{row.cancelDate}}</td>
						</tr>
						
						
						</template>
					</tbody>
				</table>
			</div>
			</div>
		</section>

		<footer id="main-footer">
			Copyright © 2015 <!-- <a href="http://www.footballer.cc"> -->成都傲赴体育有限公司 
			all rights reserved. <a href="#" class="pull-right" id="on-top-link">
				On Top &nbsp;<i class="icon-chevron-up"></i>
			</a>
		</footer>
	</section>
</body>
<script type="text/javascript">
	(function() {
		var arenaId,amId;
		var urlPre ='',iaa='';
		
		var vm = new Vue(
				{
					el : '#app',
					data : {
						playerId:null,
						name : null,
						teamName: null,
						cellPhone : null,
						weChat : null,
						comments:null,
						nonMemberlist : null,
						saveNonMemberPostUrl:'',
						updateNonMemberPostUrl:'',
						backendUserList:[],
						wechatUserList:[],
						reservationList:[]
					},
					watch : {
					},
					methods : {
						init:function(){
							arenaId = window.localStorage["arenaId"]
							urlPre = window.localStorage["urlPre"]
					 		iaa = window.localStorage["iaa"]

							vm.$data.saveNonMemberPostUrl = urlPre+'membership-service/addArenaNonMemeberInfo'+iaa
							vm.$data.updateNonMemberPostUrl = urlPre+'membership-service/updateArenaNonMemeberInfo'+iaa

						},
						getNonMemberList : function() {
							loading()
							var getNonMemberListUrl = urlPre+'membership-service/getArenaNonMemebersInfo/'+ arenaId +iaa
							$.GetJSON(getNonMemberListUrl, null,function(data) {
								if (data) {
									vm._data.nonMemberlist = data.arenaNonMemberList
									vm._data.backendUserList = _.where(vm._data.nonMemberlist, {userType: "后台"});
									vm._data.wechatUserList = _.where(vm._data.nonMemberlist, {userType: "微信"});
									hideLoading()
								}
							});
						},
						refreshList : function() {
							vm.getNonMemberList();
						},
						reservationDetail: function(e){
							playerId = e.target.id;
							
							var parameter = {
									playerId : playerId,
								};

								var getPlayerReservationListUrl = urlPre+'reservation-service/getPlayerReservationList'+iaa
							
 								//loading();
								$.postJSON(getPlayerReservationListUrl, parameter, function(data) {
									
									vm._data.reservationList = data.playerReservationList;
									
									$('#reservationInfo').show();
									$('#chargeinfo').hide();
									$('#memberinfo').hide();
									//hideLoading();
									
									//自动跳转到资金明细区域
									var t = $('#reservationInfo').offset().top;
							        $(window).scrollTop(t);
									
								}); 
								
								//测试数据
								/* var temp = {"status":"success","unUsedPlayerFieldReservationList":[],"expiredPlayerFieldReservationList":[{"fieldReservationId":120,"arenaId":null,"arenaName":"踢球者数字化足球公园","fieldId":null,"fieldName":"3号球场","startTime":"19:30:00","endTime":"21:00:00","bookDate":"2016-02-17 21:02:10.0","bookStatus":"1","cancelDate":null,"useDate":"2016-02-17","price":300,"barginPrice":200,"memberId":null,"paymentStatus":"1"},{"fieldReservationId":149,"arenaId":null,"arenaName":"踢球者数字化足球公园","fieldId":null,"fieldName":"4号球场","startTime":"19:30:00","endTime":"21:00:00","bookDate":"2016-02-22 12:07:14.0","bookStatus":"1","cancelDate":null,"useDate":"2016-02-24","price":300,"barginPrice":200,"memberId":null,"paymentStatus":"1"}],"playerReservationList":[{"fieldReservationId":120,"arenaId":null,"arenaName":"踢球者数字化足球公园","fieldId":null,"fieldName":"3号球场","startTime":"19:30:00","endTime":"21:00:00","bookDate":"2016-02-17 21:02:10.0","bookStatus":"1","cancelDate":null,"useDate":"2016-02-17","price":300,"barginPrice":200,"memberId":null,"paymentStatus":"1"},{"fieldReservationId":149,"arenaId":null,"arenaName":"踢球者数字化足球公园","fieldId":null,"fieldName":"4号球场","startTime":"19:30:00","endTime":"21:00:00","bookDate":"2016-02-22 12:07:14.0","bookStatus":"1","cancelDate":null,"useDate":"2016-02-24","price":300,"barginPrice":200,"memberId":null,"paymentStatus":"1"}]}	
								vm._data.reservationList = temp.playerReservationList;
								$('#reservationInfo').show();
								$('#chargeinfo').hide();
								$('#memberinfo').hide();
								//自动跳转到资金明细区域
								var t = $('#reservationInfo').offset().top;
						        $(window).scrollTop(t); */
								
						},
						editBtn : function(e) {
							vm._data.playerId = $(e.target).parents('tr').attr('data-id');
							
							vm.initMemberInfo(e);
							$('#memberinfo').show();
							$('#updateBtn').show();
							$('#saveBtn').hide();
							$('#userNameInput').attr("readonly","readonly");
							$('#teamNameInput').attr("readonly","readonly");
							$('#weChatInput').attr("readonly","readonly");
							$('#cellPhoneInput').attr("readonly","readonly");
							
							
							//自动跳转到会员编辑区域
					        $(window).scrollTop(0);
						},
						initMemberInfo : function(e) {
							vm._data.name = $(e.currentTarget.parentNode.parentElement.children[2]).text();
							vm._data.teamName = $(e.currentTarget.parentNode.parentElement.children[3]).text();
							vm._data.cellPhone = $(e.currentTarget.parentNode.parentElement.children[4]).text();
							//vm._data.weChat = $(e.currentTarget.parentNode.parentElement.children[6]).text();
							vm._data.weChat = '';
							vm._data.comments = $(e.currentTarget.parentNode).prev().prev().text().trim(); 

						},
						showAddMember : function() {
							$('#memberinfo').toggle();
							$('#userNameInput').removeAttr('readonly');
							$('#teamNameInput').removeAttr('readonly');
							$('#weChatInput').removeAttr('readonly');
							$('#cellPhoneInput').removeAttr('readonly');
							$('#updateBtn').hide();
							$('#saveBtn').show();
							vm.cleanMemberInfo();
						},
						sortByDate:function(){
							vm._data.nonMemberlist.sort(function(a, b){
								return CompareDate(a.createDt,b.createDt);
							});
						},
						cleanMemberInfo : function() {
							vm._data.name = null;
							vm._data.teamName = null;
							vm._data.cellPhone = null;
							vm._data.weChat = null;
							vm._data.comments = null;
						},
						cancelBtn : function() {
							vm.cleanMemberInfo();
							$('#memberinfo').hide();
						},
						saveBtn : function() {
							vm.validation();
							
							var parameter = {
								arenaId : arenaId,
								name : vm._data.name,
								teamName: vm._data.teamName,
								wechatNo : vm._data.weChat,
								cellphone : vm._data.cellPhone,
								comments : vm._data.comments
							};

							loading();
							$.postJSON(vm.$data.saveNonMemberPostUrl, parameter, function(
									data) {

								alert(data.message);
								vm.getNonMemberList();
								vm.cleanMemberInfo();
								$('#memberinfo').hide();
							});
						},
						updateBtn : function(e) {
							vm.validation();
							console.log(e.target)
							
							var parameter = {
									arenaId : arenaId,
									playerId : vm._data.playerId,
									comments : vm._data.comments.trim()
							};

							loading();
							$.postJSON(vm.$data.updateNonMemberPostUrl, parameter,
									function(data) {

										alert(data.message);
										vm.getNonMemberList();
										vm.cleanMemberInfo();
										$('#memberinfo').hide();
									});
						},
						validation : function(){
							if(vm._data.name == null || vm._data.name == ''||
									vm._data.teamName == null || vm._data.teamName == '' ||
									vm._data.cellPhone == null || vm._data.cellPhone == ''
							//		|| vm._data.weChat == null || vm._data.weChat ==''
							){
								
								alert('请输入必填项.');
								return;
							}
						}
					}
				});

		
		loginStatusCheck(pageInit);
		 
		function pageInit(){
			loadingInit();
			vm.init()
			vm.getNonMemberList();
			hidesomeloadingpart('theme_switcher');
		}

		

	})()
</script>
</html>