<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8"><![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9"><![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>会员管理</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width">
<link rel="icon" href="../img/analysis/auf_title.png" type="image/x-icon"/>
<link rel="stylesheet" href="../css/fakeLoader.min.css">
<link rel="stylesheet" type="text/css" href="../css/button.min.css">
<link rel="stylesheet" type="text/css" href="../css/justin_common.css">
<link href="../css/jquery-ui.dialog.1.11.4.min.css" rel="stylesheet" type="text/css">

<script src="assets/javascripts/1.3.0/adminflare-demo-init.min.js"
	type="text/javascript"></script>

<script type="text/javascript">
	// Include Bootstrap stylesheet 
	document
			.write('<link href="assets/css/' + DEMO_ADMINFLARE_VERSION + '/' + DEMO_CURRENT_THEME + '/bootstrap.min.css" media="all" rel="stylesheet" type="text/css" id="bootstrap-css">');
	// Include AdminFlare stylesheet 
	document
			.write('<link href="assets/css/' + DEMO_ADMINFLARE_VERSION + '/' + DEMO_CURRENT_THEME + '/adminflare.min.css" media="all" rel="stylesheet" type="text/css" id="adminflare-css">');
</script>

<script src="assets/javascripts/1.3.0/modernizr-jquery.min.js"
	type="text/javascript"></script>
<script src="assets/javascripts/1.3.0/adminflare-demo.min.js"
	type="text/javascript"></script>
<script src="assets/javascripts/1.3.0/bootstrap.min.js"
	type="text/javascript"></script>
<script src="assets/javascripts/1.3.0/adminflare.min.js"
	type="text/javascript"></script>
<script src="assets/javascripts/vue.min.js" type="text/javascript"></script>
<script src="../js/jquery-1.11.2.min.js" type="text/javascript"></script>
<script src="../js/justin_common.js" type="text/javascript"></script>
<script src="../mobile/js/lib/underscore-min.js" type="text/javascript"></script>
<script src="../js/fakeLoader.min.js" type="text/javascript"></script>
<script src="../js/jquery-ui.dialog.1.11.4.min.js" type="text/javascript"></script>

<style type="text/css">
.well, .box {
	padding-bottom: 0;
}
</style>

<script type="text/javascript">
	$(document).ready(function() {
		prettyPrint();
	});
</script>
</head>
<body>
	<div id="fakeLoader"></div>
	<script type="text/javascript">
		demoSetBodyLayout();
	</script>
	<!-- Main navigation bar
		================================================== -->
	<header class="navbar navbar-fixed-top" id="main-navbar">
		<div class="navbar-inner">
			<div class="container">
				<img id="arenaLogo" onerror="this.style.display='none'"  style="float: left;margin: 6px 0px 0px 5px;width: 28px;height: 28px;">
				<a class="logo"
					style="width: 200px;color: cornsilk; font-size: 15px;font-weight: bold; margin: 10px 8px 0px 8px;">Auf-Backend</a>
				<a class="btn nav-button collapsed" data-toggle="collapse"
					data-target=".nav-collapse"> <span class="icon-reorder"></span>
				</a>

				<div class="nav-collapse collapse">
					<ul class="nav">
						<li class="active">
							<a href="/footballer/backadmin/fieldReservation.html">预定</a></li>
						<li class="complete">
							<a href="/footballer/backadmin/battleMgmt.html" style="color: greenyellow;">约战</a></li>
						<li class="complete">
							<a href="/footballer/backadmin/soloMgmt.html" style="color: aqua;">单飞</a></li>
						<li class="divider-vertical"></li>
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown">管理<i class=" icon-caret-down"></i></a>
							<ul class="dropdown-menu">
								<li><a href="/footballer/backadmin/memberList.html">会员</a></li>
								<li><a href="/footballer/backadmin/nonmemberList.html">用户</a></li>
								<li><a href="/footballer/backadmin/fieldManagement.html">场次/价格</a></li>
								<li class="divider"></li>
								<li class="nav-header">高级功能</li>
								<li><a href="/footballer/backadmin/dataStatistics.html">数据统计</a></li>
								<li><a href="/footballer/backadmin/automationConfig.html">固定场次自动预定</a></li>
							</ul></li>
						<li class="divider-vertical"></li>
					</ul>
					<!-- <form class="navbar-search pull-left" action="" _lpchecked="1">
						<input type="text" class="search-query" placeholder="Search" style="width: 120px">
					</form> -->
					<ul class="nav pull-right">
						<li>
							<!-- <ul class="messages">
								<li><a href="#"><i class="icon-warning-sign"></i> 2<span class="responsive-text"> alerts</span></a></li>
								<li><a href="#"><i class="icon-envelope"></i> 25<span class="responsive-text"> new messages</span></a></li>
							</ul> -->
						</li>
						<li class="separator"></li>
						<li class="dropdown">
							<img onerror="this.style.display='none'" class="headIcon" src="../img/common/admin_spy.png" style="margin: 3px 0 0 1px;">
							<a href="#" class="dropdown-toggle usermenu" data-toggle="dropdown"> 
								<span id="adminName" style="width: 100px;display: block;">管理员名</span>
							</a>
							<ul class="dropdown-menu">
								<li><a onclick="updatePwdPopup();" href="#">修改密码</a></li>
								<!-- <li><a href="#">设置</a></li> -->
								<li class="divider"></li>
								<li><a onclick="loginOut();" href="/footballer/backadmin/fieldReservation.html" >登出</a></li>
							</ul>
					</ul>
				</div>
			</div>
		</div>
	</header>
	
	<div id="dialog-form" title="请先登陆"  style="display:none;">
		  <p class="validateTips"></p>
		 
		  <form>
		    <fieldset>
		      <div class="HBox">
		      	<label for="name">用户</label>
		      	<input type="text" name="name" id="name"  class="text ui-widget-content ui-corner-all">
		      </div>
		      <br>
		      <div class="HBox">
		      	<label for="password">密码</label>
		      	<input type="password" name="password" id="password"  class="text ui-widget-content ui-corner-all">
		      </div>
		      <!-- Allow form submission with keyboard without duplicating the dialog button -->
		      <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
		    </fieldset>
		  </form>
	</div>
	
	<div id="dialog-updatePwd" title="修改密码"  style="display:none;">
		  <p class="validateTips"></p>
		 
		  <form>
		    <fieldset>
		      <div class="HBox">
		      	<label for="newPwd" class="forInput">新密码</label>
		      	<input type="password" name="newPwd" id="newPwd"  class="text ui-widget-content ui-corner-all">
		      </div>
		      <br>
		      <div class="HBox">
		      	<label for="confirmPwd" class="forInput">确认密码</label>
		      	<input type="password" name="confirmPwd" id="confirmPwd"  class="text ui-widget-content ui-corner-all">
		      </div>
		      <!-- Allow form submission with keyboard without duplicating the dialog button -->
		      <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
		    </fieldset>
		  </form>
	</div>


	<section class="container" id="app">

		<section class="row-fluid" style="width: 1125px;">
			<h3 class="box-header">
				<img onerror="this.style.display='none'" class="headIcon" src="../img/common/memberIcon.png" style="margin: -7px 10px 0px 0px;">
				会员名单
			</h3>
			<div class="box">

				<div class="span11">
					<div class="HBox">
						<button v-on:click="showAddMember" id="addMember" class="label label-green" style="height: 33px;">新增会员</button>
					</div>
					<div class="box" id="memberinfo" style="display: none;">
						<div class="span11">
							<table class="hover">
								<tbody>
									<tr>
										<td>
											<p>姓名</p>
										</td>
										<td><input v-model="memberName" type="text"
											style="width: 120px"></td>
											
										<td style="padding-left: 20px;">
											<p>队名</p>
										</td>
										<td><input id="teamNameInput" v-model="memberTeamName" type="text"
											style="width: 120px"></td>	

										<td style="padding-left: 20px;">
											<p>电话</p>
										</td>
										<td><input id="cellPhoneInput" v-model="memberCellPhone" type="tel" maxlength="11"
											style="width: 120px"></td>

										<td style="padding-left: 20px;">
											<p>微信号</p>
										</td>
										<td><input id="weChatInput" v-model="memberWeChat" type="text"
											style="width: 120px"></td>
									</tr>

									<tr>
										<td>
											<p>充值金额</p>
										</td>
										<td>
											<!-- <select v-model="levelPrice" style="width: 134px">
												<option>3000</option>
												<option>6000</option>
												<option>10000</option>
											</select> -->
											<input id="priceInput" type="number" v-model="levelPrice" style="width: 121px">
										
										</td>
										
										
										<td style="padding-left: 20px;color:coral">
											<p>折扣</p>
										</td>
										<td>
											<input id="custompriceInput" type="text" v-model="customDiscount" style="width: 121px;color: coral;" placeholder="0.01-10.00" 
											 min="0.01" max="10.0" onkeyup="checkNum(this);" />
										</td>
										<td style="padding-left: 10px;" colspan=4>
												<table border="0" cellspacing="0" cellpadding="0">
												<tr>
													<td>300 =>&nbsp;</td>
													<td style="font-size: 16px;color:coral">{{(customDiscount/10*300).toFixed(0)}}</td>
													<td>&nbsp;</td>
													<td>|</td>
													<td>&nbsp;</td>
													<td>600 =>&nbsp;</td>
													<td style="font-size: 16px;color:coral">{{(customDiscount/10*600).toFixed(0)}}</td>
													<td>&nbsp;</td>
													<td>|</td>
													<td>&nbsp;</td>
													<td>1000 =>&nbsp;</td>
													<td style="font-size: 16px;color:coral">{{(customDiscount/10*1000).toFixed(0)}}</td>
												</tr>
												<tr>
													
												</tr>
												<!-- 	<tr>
													<td>1000 =></td>
													<td>{{(memberDisCount/10*1000).toFixed(0)}}</td>
												</tr> -->
												</table>
										</td>
										
										<td style="padding-left: 20px;display:none;">
											<p>级别</p>
										</td>
										<td style="display:none;">
											<select v-model="memberLevel" style="width: 134px">
													<option>1</option>
													<option>2</option>
													<option>3</option>
											</select>
										</td>
										<td style="padding-left: 20px;display:none;">
											<p>折扣</p>
										</td>
										<td style="display:none;"><select v-model="memberDisCount" style="width: 134px">
													<option>9</option>
													<option>8.5</option>
													<option>8</option>
											</select>
										</td>
									</tr>
									<tr>
										<td><p>备注信息</p></td>
										<td colspan="8"><textarea rows="" cols="" style="margin: 0px 0px 10px; width: 683px; height: 66px;" v-model="memberComments"></textarea></td>
									</tr>
									<tr>
										<td>
											<button v-on:click="cancelBtn" class="label label-red"
												style="width: 60px;">取消</button>
										</td>
										<td>
											<button id="saveBtn" v-on:click="saveBtn" class="label label-green"
												style="width: 60px;">保存</button>

											<button id="updateBtn" v-on:click="updateBtn" class="label label-green"
												style="width: 60px;display:none;">更新</button>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
					<table class="table table-hover">
						<thead>
							<tr>
								<th v-on:click="sortById"  style="cursor:pointer;width: 20px;">#</th>
								<th style="width:60px;">姓名</th>
								<th style="width:90px;">队名</th>
								<th>手机号</th>
						<!--    <th>微信号</th>
								<th v-on:click="sortByLevel" style="cursor:pointer;width:30px;">等级</th>
								<th v-on:click="sortByDiscount" style="cursor:pointer;width:30px;">折扣</th>
						 -->
								<th v-on:click="sortByBalance" style="cursor:pointer;width: 9%;text-align: center;">余额</th>
								<th style="color:coral;width: 6%;">折扣</th>
								<th style="width: 250px;">备注</th>
								<th style="width: 6%;">订场数</th>
						<!-- 	<th v-on:click="sortByDate" style="cursor:pointer;width:70px;">加入时间</th>   -->
								<th>操作</th>
							</tr>
						</thead>
						<tbody>
							<template v-for="row in memberlist">
							<tr>
								<td>{{$index+1}}</td>
								<td>{{row.name}}</td>
								<td>{{row.teams}}</td>
								<td>{{row.cellphone}}</td>
							 	
							<!--<td>{{row.wechatNo}}</td>
								<td>{{row.level}}</td>
								<td>{{row.disCount}}</td>
							 -->	
								<td style="text-align: center;">
									<div v-if="row.balance <= 1000">
										<label style="color: red; font-size: 15px;">{{row.balance}}</label>
									</div>
									<div v-else>{{row.balance}}</div>
								</td>
								<td>
									<div v-if="row.customDiscount >= 8">
										{{row.customDiscount}}
									</div>
									<div v-if="row.customDiscount < 8">
										<label style="color: coral; font-size: 15px;">{{row.customDiscount}}</label>
									</div>
								</td>
								<td>
									<div style="word-break: break-all;width: 250px;">
										{{row.comments}}
									</div>
								</td>
								<td>
									<!-- <a id="{{row.id}}" v-on:click="reservationDetail" class="button button-action button-rounded button-tiny" style="padding-right: 16px;"	>{{row.totalCount}}</a> -->
									<a id="{{row.id}}" v-on:click="reservationDetail" class="button button-glow button-border button-rounded button-tiny">{{row.totalCount}}</a>
								</td>
								
						<!-- 	<td>{{row.createDt.substr(0,10)}}</td>   -->
								<td>
									<!-- <button id="{{row.id}}" v-on:click="editBtn">编辑</button>
									<button id="{{row.id}}" v-on:click="chargeMgr">资金管理</button>
 -->								<a id="{{row.id}}" v-on:click="editBtn" class="button button-primary button-rounded button-tiny" style="">编辑</a>
									<a id="{{row.id}}" v-on:click="chargeMgr" class="button button-highlight button-rounded button-tiny" style="padding-right: 10px;">资金管理</a>
									
								</td>
							</tr>
							</template>
						</tbody>
					</table>
				</div>
			</div>
		</section>




		<section id="chargeinfo" class="row-fluid" style="display: none;">
			<h3 class="box-header">资金管理</h3>
			<div class="box">
				<div class="span12" style="display: inline-flex;">

					<div style="display: flex; height: 33px;">
						<label class="label label-cyan"
							style="width: 60px; margin-right: 30px; padding-top: 9px; padding-left: 10px; padding-bottom: 24px;">操作</label>
						<label
							style="width: 33px; padding-top: 7px; f; font-size: 14px; font-weight: bold;">金
							额</label> <input v-model="money" type="number"
							style="width: 144px; margin-right: 25px; margin-bottom: 6px; margin-top: 2px;">
						<button v-on:click="rechargeBtn" class="label label-green"
							style="width: 60px; margin-right: 10px;">充值</button>
						<button v-on:click="chargeBtn" class="label label-red"
							style="width: 60px;">扣款</button>
					</div>
				</div>
				<hr style="width: 100%;">
				<h4>资金明细 => <span style="color:#fec04e">{{memberName}}</span></h4>
				<table class="table table-hover">
					<thead>
						<tr>
							<th>#</th>
							<th>交易金额</th>
							<th>交易类型</th>
							<th>支付方式</th>
							<th>备注</th>
							<th>操作时间</th>
						</tr>
					</thead>
					<tbody>
						<template v-for="row in deallist">
						<tr>
							<td>{{row.id}}</td>
							<td>
								{{row.fee}}	
							</td>
							<td>
								<div v-if="row.feeType == 'CREDIT'">
									扣款
								</div>
								<div v-if="row.feeType == 'DEBIT'">
									充值
								</div>
							</td>
							<td>
								<div v-if="row.payMethod == 'PRESTORE'">
									预存金额
								</div>
								<div v-if="row.payMethod == 'CACHE'">
									现金
								</div>
							</td>
							<td>{{row.comment}}</td>
							<td>{{row.disPlayDate}}</td>
						</tr>
						</template>
					</tbody>
				</table>
			</div>
			</div>
		</section>
		
		
		<section id="reservationInfo" class="row-fluid" style="display: none;">
			<h3 class="box-header">订场详情</h3>
			<div class="box">
				<table class="table table-hover">
					<thead>
						<tr>
							<th>#</th>
							<th>使用日期</th>
							<th>开始时间</th>
							<th>结束时间</th>
							<th>球场</th>
							<th>类型</th>
							<th>金额</th>
							<th>订场时间</th>
							<th>取消时间</th>
						</tr>
					</thead>
					<tbody>
						<template v-for="row in reservationList">
						<tr v-if="row.cancelDate" style="color:gray;text-decoration:line-through;">
								<td>{{$index+1}}</td>
								<td>{{row.useDate}}</td>
								<td>{{row.startTime}}</td>
								<td>{{row.endTime}}</td>
								<td>{{row.fieldName}}</td>
								<td>{{row.type}}</td>
								<td v-if="row.type == 'battle'">{{(row.price)/2}}</td>
								<td v-if="row.type == 'fullField'">{{row.price}}</td>
								<td>{{row.bookDate}}</td>
								<td>{{row.cancelDate}}</td>
						</tr>
						
						<tr v-if="row.cancelDate == null" style="color: cadetblue;">
								<td>{{$index+1}}</td>
								<td>{{row.useDate}}</td>
								<td>{{row.startTime}}</td>
								<td>{{row.endTime}}</td>
								<td>{{row.fieldName}}</td>
								<td>{{row.type}}</td>
								<td v-if="row.type == 'battle'">{{(row.price)/2}}</td>
								<td v-if="row.type == 'fullField'">{{row.price}}</td>
								<td>{{row.bookDate}}</td>
								<td>{{row.cancelDate}}</td>
						</tr>
						
						
						</template>
					</tbody>
				</table>
			</div>
			</div>
		</section>


		<!-- Page footer
			================================================== -->
		<footer id="main-footer">
			Copyright © 2015 <!-- <a href="http://www.footballer.cc"> -->成都傲赴体育有限公司 
			all rights reserved. <a href="#" class="pull-right" id="on-top-link">
				On Top &nbsp;<i class="icon-chevron-up"></i>
			</a>
		</footer>
		<!-- / Page footer -->
	</section>
</body>
<script type="text/javascript">
	(function() {
		var arenaId;
		var amId
		var urlPre ='',iaa='';
		
		var vm = new Vue(
				{
					el : '#app',

					data : {
						memberName : null,
						memberTeamName: null,
						memberCellPhone : null,
						memberWeChat : null,
						memberLevel : null,
						memberDisCount : null,
						customDiscount:null,
						memberlist : null,
						memberComments:null,
						deallist : null,
						money : null,
						levelPrice : null,
						chargeMoneyPostUrl:'',
						saveMemberPostUrl:'',
						updateMemberPostUrl:'',
						getPlayerReservationListUrl:'',
						reservationList:[]
					},
					watch : {
						/* levelPrice : function(val) {
							switch (val) {
							case '3000':
								vm._data.memberLevel = 1;
								vm._data.memberDisCount = 9
								break;
							case '6000':
								vm._data.memberLevel = 2;
								vm._data.memberDisCount = 8.5
								break;
							case '10000':
								vm._data.memberLevel = 3;
								vm._data.memberDisCount = 8
								break;
							default:

							}
						},
						memberLevel : function(val) {
							switch (val) {
							case '1':
								vm._data.levelPrice = 3000;
								vm._data.memberDisCount = 9
								break;
							case '2':
								vm._data.levelPrice = 6000;
								vm._data.memberDisCount = 8.5
								break;
							case '3':
								vm._data.levelPrice = 10000;
								vm._data.memberDisCount = 8
								break;
							default:

							}
						},
						memberDisCount : function(val) {
							switch (val) {
							case '9':
								vm._data.memberLevel = 1;
								vm._data.levelPrice = 3000;
								break;
							case '8.5':
								vm._data.memberLevel = 2;
								vm._data.levelPrice = 6000;
								break;
							case '8':
								vm._data.memberLevel = 3;
								vm._data.levelPrice = 10000;
								break;
							default:

							}
						} */
					},
					methods : {
						init:function(){
							arenaId = window.localStorage["arenaId"];
							urlPre = window.localStorage["urlPre"]
					 		iaa = window.localStorage["iaa"]

							vm.$data.chargeMoneyPostUrl = urlPre+'membership-service/manageArenaMemberFunds'+iaa;
							vm.$data.saveMemberPostUrl = urlPre+'membership-service/addArenaMemeberInfo'+iaa;
							vm.$data.updateMemberPostUrl = urlPre+'membership-service/updateArenaMemeberInfo'+iaa;
							vm.$data.getPlayerReservationListUrl = urlPre+'reservation-service/getPlayerReservationList'+iaa;
						},
						getMemberList : function() {
							loading();	 
							var getMemberListUrl = urlPre + 'membership-service/getArenaMemebersInfo/'+ arenaId +iaa
							$.GetJSON(getMemberListUrl, null,function(data) {
								if (data) {
									vm._data.memberlist = data.arenaMemberList
									hideLoading();
								}
							}); 						
 								
							//测试数据
 							/* loading();
							var temp = {"status":"success","message":null,"memberShipResult":null,"arenaMemberList":[{"id":1,"arenaId":52,"playerId":1,"memberId":1,"number":1,"name":"保留号","type":null,"imageUrl":null,"teams":"踢球者二队,t1,踢球者,Madrid","level":1,"disCount":9.0,"balance":99150.00,"wechatNo":"Bayern_NeverGiveUp","cellphone":18180629919,"createDt":"2015-11-12 16:00:00.0","fullFieldBookNumber":null,"battleBookNumber":null,"bookTotalNumber":null,"comments":"这个是哥 一般人不敢乱点 乱操作的!!!","totalCount":26,"customPrice":null,"userType":null,"imgUrl":null},{"id":43,"arenaId":52,"playerId":109,"memberId":37,"number":23,"name":"雷宇","type":null,"imageUrl":null,"teams":"SPA","level":2,"disCount":8.5,"balance":-1150.00,"wechatNo":"18508100871","cellphone":18508100871,"createDt":"2016-02-15 12:27:31.0","fullFieldBookNumber":null,"battleBookNumber":null,"bookTotalNumber":null,"comments":null,"totalCount":3,"customPrice":null,"userType":null,"imgUrl":null},{"id":23,"arenaId":52,"playerId":49,"memberId":17,"number":4,"name":"陈俊","type":null,"imageUrl":null,"teams":"/","level":1,"disCount":9.0,"balance":600.00,"wechatNo":"","cellphone":13679055317,"createDt":"2016-01-25 11:50:17.0","fullFieldBookNumber":null,"battleBookNumber":null,"bookTotalNumber":null,"comments":null,"totalCount":2,"customPrice":null,"userType":null,"imgUrl":null},{"id":39,"arenaId":52,"playerId":65,"memberId":33,"number":20,"name":"陈煜","type":null,"imageUrl":null,"teams":"/","level":1,"disCount":9.0,"balance":900.00,"wechatNo":null,"cellphone":13688038606,"createDt":"2016-01-25 12:09:13.0","fullFieldBookNumber":null,"battleBookNumber":null,"bookTotalNumber":null,"comments":null,"totalCount":2,"customPrice":null,"userType":null,"imgUrl":null},{"id":45,"arenaId":52,"playerId":119,"memberId":39,"number":24,"name":"Comments","type":null,"imageUrl":null,"teams":"Test","level":1,"disCount":9.0,"balance":2700.00,"wechatNo":"1","cellphone":1,"createDt":"2016-02-29 14:47:44.0","fullFieldBookNumber":null,"battleBookNumber":null,"bookTotalNumber":null,"comments":"asdfasdfsafsfasdfasdfasd","totalCount":2,"customPrice":null,"userType":null,"imgUrl":null},{"id":26,"arenaId":52,"playerId":52,"memberId":20,"number":7,"name":"黄璜","type":null,"imageUrl":null,"teams":"东山坡","level":1,"disCount":9.0,"balance":0.00,"wechatNo":null,"cellphone":18982063818,"createDt":"2016-01-25 11:55:46.0","fullFieldBookNumber":null,"battleBookNumber":null,"bookTotalNumber":null,"comments":null,"totalCount":1,"customPrice":null,"userType":null,"imgUrl":null},{"id":32,"arenaId":52,"playerId":58,"memberId":26,"number":13,"name":"敬明俊","type":null,"imageUrl":null,"teams":"/","level":1,"disCount":9.0,"balance":0.00,"wechatNo":null,"cellphone":18080811928,"createDt":"2016-01-25 12:00:24.0","fullFieldBookNumber":null,"battleBookNumber":null,"bookTotalNumber":null,"comments":null,"totalCount":1,"customPrice":null,"userType":null,"imgUrl":null},{"id":37,"arenaId":52,"playerId":63,"memberId":31,"number":18,"name":"曾勇","type":null,"imageUrl":null,"teams":"/","level":1,"disCount":9.0,"balance":-300.00,"wechatNo":null,"cellphone":18123377573,"createDt":"2016-01-25 12:04:04.0","fullFieldBookNumber":null,"battleBookNumber":null,"bookTotalNumber":null,"comments":null,"totalCount":1,"customPrice":null,"userType":null,"imgUrl":null},{"id":41,"arenaId":52,"playerId":67,"memberId":35,"number":22,"name":"阿杰","type":null,"imageUrl":null,"teams":"/","level":1,"disCount":9.0,"balance":30.00,"wechatNo":null,"cellphone":13222222222,"createDt":"2016-01-25 12:14:07.0","fullFieldBookNumber":null,"battleBookNumber":null,"bookTotalNumber":null,"comments":null,"totalCount":1,"customPrice":null,"userType":null,"imgUrl":null},{"id":21,"arenaId":52,"playerId":47,"memberId":15,"number":2,"name":"廖敏魁","type":null,"imageUrl":null,"teams":"/","level":1,"disCount":9.0,"balance":0.00,"wechatNo":"/","cellphone":13981716398,"createDt":"2016-01-25 10:22:41.0","fullFieldBookNumber":null,"battleBookNumber":null,"bookTotalNumber":null,"comments":null,"totalCount":0,"customPrice":null,"userType":null,"imgUrl":null},{"id":22,"arenaId":52,"playerId":48,"memberId":16,"number":3,"name":"陈开弟","type":null,"imageUrl":null,"teams":"/","level":1,"disCount":9.0,"balance":95.00,"wechatNo":null,"cellphone":13518162188,"createDt":"2016-01-25 11:41:11.0","fullFieldBookNumber":null,"battleBookNumber":null,"bookTotalNumber":null,"comments":null,"totalCount":0,"customPrice":null,"userType":null,"imgUrl":null},{"id":24,"arenaId":52,"playerId":50,"memberId":18,"number":5,"name":"焦坤","type":null,"imageUrl":null,"teams":"/","level":1,"disCount":9.0,"balance":245.00,"wechatNo":null,"cellphone":18615700025,"createDt":"2016-01-25 11:54:05.0","fullFieldBookNumber":null,"battleBookNumber":null,"bookTotalNumber":null,"comments":null,"totalCount":0,"customPrice":null,"userType":null,"imgUrl":null},{"id":25,"arenaId":52,"playerId":51,"memberId":19,"number":6,"name":"宋雨","type":null,"imageUrl":null,"teams":"/","level":1,"disCount":9.0,"balance":280.00,"wechatNo":null,"cellphone":18781947673,"createDt":"2016-01-25 11:55:07.0","fullFieldBookNumber":null,"battleBookNumber":null,"bookTotalNumber":null,"comments":null,"totalCount":0,"customPrice":null,"userType":null,"imgUrl":null},{"id":27,"arenaId":52,"playerId":53,"memberId":21,"number":8,"name":"何天野","type":null,"imageUrl":null,"teams":"/","level":1,"disCount":9.0,"balance":0.00,"wechatNo":null,"cellphone":18628124233,"createDt":"2016-01-25 11:56:28.0","fullFieldBookNumber":null,"battleBookNumber":null,"bookTotalNumber":null,"comments":null,"totalCount":0,"customPrice":null,"userType":null,"imgUrl":null},{"id":28,"arenaId":52,"playerId":54,"memberId":22,"number":9,"name":"唐玮俊","type":null,"imageUrl":null,"teams":"/","level":1,"disCount":9.0,"balance":2840.00,"wechatNo":null,"cellphone":13551239972,"createDt":"2016-01-25 11:57:15.0","fullFieldBookNumber":null,"battleBookNumber":null,"bookTotalNumber":null,"comments":null,"totalCount":0,"customPrice":null,"userType":null,"imgUrl":null},{"id":29,"arenaId":52,"playerId":55,"memberId":23,"number":10,"name":"李一川","type":null,"imageUrl":null,"teams":"/","level":1,"disCount":9.0,"balance":400.00,"wechatNo":null,"cellphone":13981712102,"createDt":"2016-01-25 11:58:09.0","fullFieldBookNumber":null,"battleBookNumber":null,"bookTotalNumber":null,"comments":null,"totalCount":0,"customPrice":null,"userType":null,"imgUrl":null},{"id":30,"arenaId":52,"playerId":56,"memberId":24,"number":11,"name":"黄俊","type":null,"imageUrl":null,"teams":"/","level":1,"disCount":9.0,"balance":300.00,"wechatNo":null,"cellphone":18628285329,"createDt":"2016-01-25 11:58:51.0","fullFieldBookNumber":null,"battleBookNumber":null,"bookTotalNumber":null,"comments":null,"totalCount":0,"customPrice":null,"userType":null,"imgUrl":null},{"id":31,"arenaId":52,"playerId":57,"memberId":25,"number":12,"name":"曹代强","type":null,"imageUrl":null,"teams":"/","level":1,"disCount":9.0,"balance":0.00,"wechatNo":null,"cellphone":13882185327,"createDt":"2016-01-25 11:59:34.0","fullFieldBookNumber":null,"battleBookNumber":null,"bookTotalNumber":null,"comments":null,"totalCount":0,"customPrice":null,"userType":null,"imgUrl":null},{"id":33,"arenaId":52,"playerId":59,"memberId":27,"number":14,"name":"贾韬","type":null,"imageUrl":null,"teams":"/","level":1,"disCount":9.0,"balance":40.00,"wechatNo":null,"cellphone":13980475171,"createDt":"2016-01-25 12:01:06.0","fullFieldBookNumber":null,"battleBookNumber":null,"bookTotalNumber":null,"comments":null,"totalCount":0,"customPrice":null,"userType":null,"imgUrl":null},{"id":34,"arenaId":52,"playerId":60,"memberId":28,"number":15,"name":"周宇","type":null,"imageUrl":null,"teams":"/","level":1,"disCount":9.0,"balance":0.00,"wechatNo":null,"cellphone":18602808856,"createDt":"2016-01-25 12:01:50.0","fullFieldBookNumber":null,"battleBookNumber":null,"bookTotalNumber":null,"comments":null,"totalCount":0,"customPrice":null,"userType":null,"imgUrl":null},{"id":35,"arenaId":52,"playerId":61,"memberId":29,"number":16,"name":"陈东","type":null,"imageUrl":null,"teams":"/","level":1,"disCount":9.0,"balance":180.00,"wechatNo":null,"cellphone":13541258155,"createDt":"2016-01-25 12:02:36.0","fullFieldBookNumber":null,"battleBookNumber":null,"bookTotalNumber":null,"comments":null,"totalCount":0,"customPrice":null,"userType":null,"imgUrl":null},{"id":36,"arenaId":52,"playerId":62,"memberId":30,"number":17,"name":"钟坤","type":null,"imageUrl":null,"teams":"/","level":1,"disCount":9.0,"balance":0.00,"wechatNo":null,"cellphone":13882266231,"createDt":"2016-01-25 12:03:20.0","fullFieldBookNumber":null,"battleBookNumber":null,"bookTotalNumber":null,"comments":null,"totalCount":0,"customPrice":null,"userType":null,"imgUrl":null},{"id":38,"arenaId":52,"playerId":64,"memberId":32,"number":19,"name":"黄禹","type":null,"imageUrl":null,"teams":"/","level":1,"disCount":9.0,"balance":110.00,"wechatNo":null,"cellphone":15528216252,"createDt":"2016-01-25 12:07:53.0","fullFieldBookNumber":null,"battleBookNumber":null,"bookTotalNumber":null,"comments":null,"totalCount":0,"customPrice":null,"userType":null,"imgUrl":null},{"id":40,"arenaId":52,"playerId":66,"memberId":34,"number":21,"name":"刘同","type":null,"imageUrl":null,"teams":"/","level":1,"disCount":9.0,"balance":250.00,"wechatNo":null,"cellphone":13111111111,"createDt":"2016-01-25 12:13:23.0","fullFieldBookNumber":null,"battleBookNumber":null,"bookTotalNumber":null,"comments":null,"totalCount":0,"customPrice":null,"userType":null,"imgUrl":null},{"id":47,"arenaId":52,"playerId":143,"memberId":41,"number":26,"name":"accoutidentitytest","type":null,"imageUrl":null,"teams":"场馆队","level":3,"disCount":8.0,"balance":10000.00,"wechatNo":"justinmind1231231","cellphone":13500000003,"createDt":"2016-04-17 18:36:49.0","fullFieldBookNumber":null,"battleBookNumber":null,"bookTotalNumber":null,"comments":null,"totalCount":0,"customPrice":null,"userType":null,"imgUrl":null}],"arenaNonMemberList":null,"arenaMemberBalanceLinesList":null,"arenaMemberDiscountList":null}
							vm._data.memberlist = temp.arenaMemberList;
							hideLoading(); */ 
						},
						getMemberBanlaneLines : function(amId) {
							var getMemberBanlaneLinesUrl = urlPre +'membership-service/getArenaMemeberBalanceLines/'+amId+iaa;
							$.GetJSON(getMemberBanlaneLinesUrl,null,function(data) {
								if (data) {
									vm._data.deallist = data.arenaMemberBalanceLinesList;
								}
							});
						},
						refreshList : function() {
							vm.getMemberList();
							vm.getMemberBanlaneLines(amId);
						},
						editBtn : function(e) {
							amId = e.target.id;
							vm.initMemberInfo(e);
							$('#memberinfo').show();
							$('#updateBtn').show();
							$('#saveBtn').hide();
							
							$('#chargeinfo').hide();
							$('#reservationInfo').hide();
							$('#weChatInput').attr("readonly","readonly");
							$('#cellPhoneInput').attr("readonly","readonly");
							$('#teamNameInput').attr("readonly","readonly");
							$('#priceInput').attr("readonly","readonly");
							
							//自动跳转到会员编辑区域
					        $(window).scrollTop(0);
							
						},
						chargeMgr : function(e) {
							amId = e.target.id;
							vm.initMemberInfo(e);
							$('#chargeinfo').show();
							$('#memberinfo').hide();
							$('#reservationInfo').hide();
							vm.getMemberBanlaneLines(amId);
							
							//自动跳转到资金明细区域
							var t = $('#chargeinfo').offset().top;
					        $(window).scrollTop(t);
						},
						reservationDetail: function(e){
							amId = e.target.id;
							
							var parameter = {
									arenaMemberId : amId,
								};

 								//loading();
								$.postJSON(vm.$data.getPlayerReservationListUrl, parameter, function(data) {
									
									vm._data.reservationList = data.playerReservationList;
									
									$('#reservationInfo').show();
									$('#chargeinfo').hide();
									$('#memberinfo').hide();
									//hideLoading();
									
									//自动跳转到资金明细区域
									var t = $('#reservationInfo').offset().top;
							        $(window).scrollTop(t);
									
								}); 
								
								//测试数据
								/* var temp = {"status":"success","unUsedPlayerFieldReservationList":[],"expiredPlayerFieldReservationList":[{"fieldReservationId":120,"arenaId":null,"arenaName":"踢球者数字化足球公园","fieldId":null,"fieldName":"3号球场","startTime":"19:30:00","endTime":"21:00:00","bookDate":"2016-02-17 21:02:10.0","bookStatus":"1","cancelDate":null,"useDate":"2016-02-17","price":300,"barginPrice":200,"memberId":null,"paymentStatus":"1"},{"fieldReservationId":149,"arenaId":null,"arenaName":"踢球者数字化足球公园","fieldId":null,"fieldName":"4号球场","startTime":"19:30:00","endTime":"21:00:00","bookDate":"2016-02-22 12:07:14.0","bookStatus":"1","cancelDate":null,"useDate":"2016-02-24","price":300,"barginPrice":200,"memberId":null,"paymentStatus":"1"}],"playerReservationList":[{"fieldReservationId":120,"arenaId":null,"arenaName":"踢球者数字化足球公园","fieldId":null,"fieldName":"3号球场","startTime":"19:30:00","endTime":"21:00:00","bookDate":"2016-02-17 21:02:10.0","bookStatus":"1","cancelDate":null,"useDate":"2016-02-17","price":300,"barginPrice":200,"memberId":null,"paymentStatus":"1"},{"fieldReservationId":149,"arenaId":null,"arenaName":"踢球者数字化足球公园","fieldId":null,"fieldName":"4号球场","startTime":"19:30:00","endTime":"21:00:00","bookDate":"2016-02-22 12:07:14.0","bookStatus":"1","cancelDate":null,"useDate":"2016-02-24","price":300,"barginPrice":200,"memberId":null,"paymentStatus":"1"}]}	
								vm._data.reservationList = temp.playerReservationList;
								$('#reservationInfo').show();
								$('#chargeinfo').hide();
								$('#memberinfo').hide();
								//自动跳转到资金明细区域
								var t = $('#reservationInfo').offset().top;
						        $(window).scrollTop(t); */
								
						},
						initMemberInfo : function(e) {
							vm._data.memberName = $(e.currentTarget.parentNode.parentElement.children[1]).text();
							vm._data.memberTeamName = $(e.currentTarget.parentNode.parentElement.children[2]).text();
							vm._data.memberCellPhone = $(e.currentTarget.parentNode.parentElement.children[3]).text();
							//vm._data.memberWeChat = $(e.currentTarget.parentNode.parentElement.children[4]).text();
							vm._data.customDiscount = $(e.currentTarget.parentNode.parentElement.children[5]).text().trim();
							vm._data.memberComments = $(e.currentTarget.parentNode.parentElement.children[6]).text().trim();
							vm._data.memberLevel = 1;//暂时都设为1 ，还未出来会员级别
						   
							/* vm._data.memberLevel = $(
									e.currentTarget.parentNode.parentElement.children[5])
									.text(); */
							 
						},
						rechargeBtn : function() {
							if (amId) {
								var parameter = {
									arenaMemberId : amId,
									price : vm._data.money
								};

								$.postJSON(vm.$data.chargeMoneyPostUrl, parameter,
										function(data) {
											vm.refreshList();
											alert(data.message);
											vm._data.money = '';
										});
							}
						},
						chargeBtn : function() {
							if (amId) {
								var parameter = {
									arenaMemberId : amId,
									price : -vm._data.money
								};

								$.postJSON(vm.$data.chargeMoneyPostUrl, parameter,
										function(data) {
											vm.refreshList();
											alert(data.message);
											vm._data.money = '';
										});
							}
						},
						showAddMember : function() {
							$('#memberinfo').toggle();
							$('#weChatInput').removeAttr('readonly');
							$('#cellPhoneInput').removeAttr('readonly');
							$('#teamNameInput').removeAttr('readonly');
							$('#priceInput').removeAttr('readonly');
							$('#updateBtn').hide();
							$('#saveBtn').show();
							vm.cleanMemberInfo();
						},
						sortById:function(){
							vm._data.memberlist.sort(function(a, b){
								 return a.memberId-b.memberId
								});
						},
						sortByBalance: function(){
							vm._data.memberlist.sort(function(a, b){
								 return a.balance-b.balance
								});
						},
						sortByLevel: function(){
							vm._data.memberlist.sort(function(a, b){
								 return a.level-b.level
								});
						},
						sortByDiscount: function(){
							vm._data.memberlist.sort(function(a, b){
								 return a.disCount-b.disCount
								});
						},
						sortByDate:function(){
							vm._data.memberlist.sort(function(a, b){
								 return CompareDate(a.createDt,b.createDt);
								});
						},
						cleanMemberInfo : function() {
							vm._data.memberName = null;
							vm._data.memberTeamName = null;
							vm._data.memberCellPhone = null;
							vm._data.memberWeChat = null;
							vm._data.memberLevel = 0;
							vm._data.memberDisCount = 10;
							vm._data.levelPrice = null;
							vm._data.memberComments = null;
							vm._data.customDiscount = 10;
						},
						cancelBtn : function() {
							vm.cleanMemberInfo();
							$('#memberinfo').hide();
						},
						saveBtn : function() {

							if(vm.validation()){
								var parameter = {
										arenaId : arenaId,
										name : vm._data.memberName,
										teamName: vm._data.memberTeamName,
										wechatNo : vm._data.memberWeChat,
										cellphone : vm._data.memberCellPhone,
										price : vm._data.levelPrice,
										comments : vm._data.memberComments
									};

									loading();
									$.postJSON(vm.$data.saveMemberPostUrl, parameter, function(
											data) {
										if(data.status == 'success'){
											vm.getMemberList();
											vm.cleanMemberInfo();
											$('#memberinfo').hide();	
										}else{
											alert(data.message);
										}	
									});
	
							}
						},
						updateBtn : function() {
							var parameter = {
								arenaId : arenaId,
					    		arenaMemberId :amId,
					    		name : vm._data.memberName,
					    		customDiscount: vm._data.customDiscount,
					    	    level :  vm._data.memberLevel,
					    	    comments: vm._data.memberComments.trim()
							};

							if(vm._data.customDiscount >0 && vm._data.customDiscount !=''){
								loading();
								$.postJSON(vm.$data.updateMemberPostUrl, parameter,
									function(data) {
										if(data.status == 'success'){
											vm.getMemberList();
											vm.cleanMemberInfo();
											$('#memberinfo').hide();
											hideLoading();	
										}else{
											alert(data.message);
											hideLoading();
											vm.getMemberList();
										}	
								});
							}else{
								alert('请输入正确得折扣值. 范围为： 0.01-10.00');
							}
						},
						validation : function(){
							if(vm._data.memberName == null || vm._data.memberName == ''){
								alert('请输入用户名');
								return false;
							}
							
							if(vm._data.memberTeamName == null || vm._data.memberTeamName == ''){
								alert('请输入所在球队名');
								return false;
							}
							
							if(vm._data.memberCellPhone == null || vm._data.memberCellPhone ==''){
								alert('请输入用户手机便于之后联系和查询.');
								return false;
							}else if(vm._data.memberCellPhone.length != 11){
								alert('请输入11位手机号');
								return false;
							}
							
							if(vm._data.levelPrice == null || vm._data.levelPrice ==''){
								alert('请输入充值金额.');
								return false;
							}else if(vm._data.levelPrice <=0){
								alert('充值金额必须大于0');
								return false;
							}
	
							if(vm._data.customDiscount <= 0 || vm._data.customDiscount ==''){
								alert('请输入正确得折扣值.');
								return false;
							}
							
							
							return true;							
						}
					}
				});

		loginStatusCheck(pageInit);
		 
		function pageInit(){
			loadingInit();
			vm.init()
			vm.getMemberList();	
			hidesomeloadingpart('theme_switcher');
		}
		
		

	})()
	
	function checkNum(obj) {
		 obj.value = obj.value.replace(/[^\d.]/g,""); //清除"数字"和"."以外的字符  
	     obj.value = obj.value.replace(/^\./g,""); //验证第一个字符是数字而不是  
	     obj.value = obj.value.replace(/\.{2,}/g,"."); //只保留第一个. 清除多余的  
	     obj.value = obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".");  
	     obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/,'$1$2.$3'); //只能输入两个小数  
	     
	     if(obj.value> 10){
	    	 obj.value = 10
	     }
	      
	}
</script>
</html>