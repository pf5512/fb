<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
        <meta name="format-detection" content="telephone=no">
        <link rel="stylesheet" href="../../css/frozen.css">
        <link rel="stylesheet" href="../../css/drawer.min.css">
        <link rel="stylesheet" href="../../css/match.css">
        <link rel="stylesheet" href="../../../css/justin_mobile_common.css">
    </head>
    
<body class="drawer drawer--left">

	<div class="ui-loading-block show">
	    <div class="ui-loading-cnt">
	        <i class="ui-loading-bright"></i>
	        <p>loading...</p>
	    </div>
	</div>

	<div id="app" v-cloak>
    	<header class="ui-header ui-header-positive ui-border-b">
    		<i class="ui-icon-return" onclick="history.back()"></i>
    		<h1>{{personalcetner}}</h1>
        </header>
       <section class="ui-container">
			<section class="ui-selector personalCenter">
					
					<div style="position:relative;width:100%;">
					
					
					<div v-if="playerItem.playerLogo" class="ui-avatar-lg" style="width: 160px;height: 160px;">
						<img v-if="playerItem.showWXLogo" src="{{playerItem.playerLogo}}" class="img_avatar"/>
						<img v-else src="http://static.footballer.cc//{{playerItem.playerLogo}}" class="img_avatar"/>
                    </div>
                    
                    <div v-else class="ui-avatar-lg" style="width: 160px;height: 160px;">
							<img src="../../../img/app/football_career_edited_2.png" style="width: 160px;height: 160px;background-color: #f8f8f8;"></img>
					</div>
                    
                    <input id="img_upload" type="file" accept="image/*;" capture="camera" class="input-upload-image">
                    <img class="upload-btn-img" src="../../image/camera2.png" id="imgInfo">
                    </div>
                    
                    <div class="demo-item">
				        <ul class="ui-row-flex ui-border-tb" style="">
								<li style="display: inline-flex;">
									<i class="ui-icon-emo" style="width:30px;height:30px;margin:-5px 0 13px 0px;"></i>
									<span class="span14" style="margin: 10px 0px 0px 5px;">Personal Information</span>
								</li>
						</ul>
				        <div class="demo-block">
				            <div class="ui-form ui-border-t">
				                <form action="#">
				                    <div class="ui-form-item ui-form-item-show ui-border-b">
				                        <label for="#">Name</label>
				                        <input type="text" id="user_nickName" value="{{playerItem.playerName}}">
				                    </div>
				                    <div class="ui-form-item ui-form-item-show ui-border-b">
				                        <label for="#">Birth</label>
				                        <input type="date" id="inputBirth" value="{{playerItem.birth}}">
				                    </div>
				                    <div class="ui-form-item ui-form-item-show ui-border-b">
				                        <label for="#">Height (CM)</label>
				                        <input type="number" id="inputHeight" value="{{playerItem.height}}" min="100" max="300" v-on:change="playerHeightChange">
				                    </div>
				                    <div class="ui-form-item ui-form-item-show ui-border-b">
				                        <label for="#">Weight (KG)</label>
				                        <input type="number" id="inputWeight" value="{{playerItem.weight}}" min="30" max="200" v-on:change="playerWeightChange">
				                    </div>
				                   <!--  <div class="ui-form-item ui-form-item-show ui-border-b">
				                        <label for="#">Nation</label>
				                        <input type="text" id="user_nickName" value="{{loggedUserNickName}}">
				                    </div> -->
				                </form>
				            </div>
				        </div>
				        
				        <p class="demo-desc">TeamInfo</p>
				        <div class="demo-block">
				            <div v-for="t in playerWithTeamsList" class="ui-border-t" style="background-color:white">
				                <ul class="ui-row-flex" >
								    <li class="ui-col ui-col-3 ui-flex pl10">
								        <div class="ui-list-thumb">
								            <span style="background-image:url(http://static.footballer.cc/{{t.teamLogo}})"></span>
								        </div>
								        <div class="ui-list-info">
								        	<label class="ui-txt-default">{{t.teamName}}</label>
								        </div>
								    </li>
								    <li class="ui-col ui-col-1 ui-flex ui-flex-pack-center">
								    	<div class="ui-list-info">
								    	 	<label class="ui-txt-default fs8">No:</label>
								        </div>
								    	 <div class="ui-list-info">
								    	 	<input type="number" data-teamId="{{t.teamId}}" value="{{t.teamNumber}}" min="0" max="1000" v-on:change="playerNumberChange">
								    	 	<!-- <label>{{t.teamNumber}}</label> -->
								        </div>
								    </li>
								    <li class="ui-col ui-col-1 ui-flex ui-flex-pack-end">
								    	<div class="ui-list-info">
								    	 	<label class="ui-txt-default fs8">Pos:</label>
								        </div>
								    	<div class="ui-list-info">
											<select id="postion" data-teamId="{{t.teamId}}" v-model="t.teamPosition" v-on:change="playerPositionChange">
												<option v-for="p in positionList" v-bind:value="p.value" >{{p.text}}</option>
											</select>
								        </div>
								    </li>
								</ul>
				            </div>
				        </div>
				    </div>
		
			</section>
		</section>
		
		<div class="ui-btn-wrap" >
	        <button id="btnConfirmUpdate" class="ui-btn-lg ui-btn-primary nav ui-btn-primary-login" v-on:click="updateInfo">
	            {{confirm}}
	        </button>
	    </div>
	</div>

<script src="../../../i18n/env.js"></script>
<script src="../../../js/jquery-1.11.2.min.js" type="text/javascript"></script>  
<script src="../../js/lib/zeptojs/zepto.min.js"></script>
<script src="../../js/frozen.js"></script>
<script src="../../js/server/service.js"></script>
<script src="../../../js/justin_common.js"></script>
<script src="../../js/lib/vue.min.js"></script>
<script src="../../js/lib/underscore-min.js"></script>
<script src="../../../js/jquery.i18n.properties-min-1.2.2.js" type="text/javascript" ></script>

<script src="../../js/iscroll.min.js"></script>
<script src="../../js/drawer.min.js"></script>
<script src="../../js/h5_upload.js"></script>

<script>
accessStats()

$(document).ready(function() {
	
    		var vm,currentPlayer
    		lang = f$.cache('lang')
    		tournamentId = getParameter(window.location.href ,"tournamentId")
    		
	    	
	    	vm = new Vue({
	    		el   : '#app',
	    		data : {
	    			domain:'',
	    			suffix:'',
	    			matchListName:'loading',
	    			personalcetner:'',
	    			logout:'',
	    			confirm:'',
	    			playerWithTeamsList:[],
	    			playerItem:{},
	    			positionList:[{text:'PG', value:'PG'},{text:'SG', value:'SG'},{text:'SF', value:'SF'},{text:'PF', value:'PF'},{text:'C', value:'C'},{text:'/', value:'/'}],
	    		},
	    		methods: {
	    			init:function() {	    				
	    				vm.$data.domain =  GLOBAL_VAR_DOMAIN;
				        vm.$data.suffix = GLOBAL_VAR_SUFFIX;
	    				
 	    				$.i18n.properties({// 加载中文properties文件  
	    	    		    name:'lan', // properties文件名称  
	    	    		    path:'../../../i18n/', // properties文件路径  
	    	    		    mode:'map', // 用 Map 的方式使用资源文件中的值
	    	    		    language:lang,
	    	    		    checkAvailableLanguages: true,
	    	    		    callback: function() {// 加载成功后设置显示内容  
	    	    		        vm.$data.matchListName =  $.i18n.prop('match_list_name');
	    	    		        vm.$data.personalcetner =  $.i18n.prop('personalcetner');
	    	    		        vm.$data.logout =  $.i18n.prop('logout');
	    	    		        vm.$data.footballer =  $.i18n.prop('footballer');
	    	    		        vm.$data.personalInfo =  $.i18n.prop('personalInfo');
	    	    		        vm.$data.account =  $.i18n.prop('account');
	    	    		        vm.$data.nick_name =  $.i18n.prop('nick_name');
	    	    		        vm.$data.confirm =  $.i18n.prop('confirm');
	    	    		    }
	    	    		});
	    				
 	    				currentPlayer = f$.cacheObj('currentPlayer')
	 	   				if(currentPlayer.logo.indexOf('mmopen')>0){
	 	   					currentPlayer.showWXLogo = true;
	 	   				}else{
	 	   					currentPlayer.showWXLogo = false;
	 	   				}
 	    				
 	    				//alert("currentPlayer.id: " +currentPlayer.id)
 	    				
 	    				vm.loadData();
	    			},
	    			loadData : function(){
	    				f$.getPlayerAndBasketBallTeamsInfo(vm.$data.domain,vm.$data.suffix, currentPlayer.id).done(function(data) {
							if(data.status == 'success' ){
								if(data.playerWithTeamsList){
									vm.$data.playerWithTeamsList = data.playerWithTeamsList
									$.each(vm.$data.playerWithTeamsList,function(i,v){
										if(v.teamPosition == null || v.teamPosition == void 0 || v.teamPosition == ''){
											v.teamPosition = '/'
										}
									})
									vm.$data.playerItem = vm.$data.playerWithTeamsList[0]
									vm.$data.playerItem.birth = formatToDateString(new Date(vm.$data.playerItem.birth));
									
									if(vm.$data.playerItem.playerLogo && vm.$data.playerItem.playerLogo.indexOf('mmopen')>0){
										vm.$data.playerItem.showWXLogo = true;
				    				}else{
				    					vm.$data.playerItem.showWXLogo = false;
				    				}
									
									
								}
								
								
								
							}
	    		   		});	    				
	    			},
	    			playerHeightChange : function(e){
	    				newValue = $(e.target).val()
	    				if(newValue <= 100 || newValue >= 300){
	    					alert('Come on man. seriously... be real...')
	    					$(e.target).val('')
	    				}
	    			},
					playerWeightChange : function(e){
						newValue = $(e.target).val()
	    				if(newValue <= 30 || newValue >= 200){
	    					alert('Come on man. seriously...  be real...')
	    					$(e.target).val('')
	    				}
						
	    			},
	    			playerNumberChange : function(e){
	    				newValue = $(e.target).val()
	    				currentTeamId = $(e.target).attr('data-teamId')
	    				
	    				$.each(vm.$data.playerWithTeamsList, function(i,v){
	    					if(v.teamId == currentTeamId){
	    						v.teamNumber = newValue
	    						return
	    					}
	    				})
	    			},
					playerPositionChange : function(e){
						newValue = $(e.target).val()
						currentTeamId = $(e.target).attr('data-teamId')
						
						$.each(vm.$data.playerWithTeamsList, function(i,v){
	    					if(v.teamId == currentTeamId){
	    						v.teamPosition = newValue
	    						return
	    					}
	    				})
	    			},
	    			updateInfo:function(nickname) {
	    				
	    				
	    				var playerName = $('#user_nickName').val().trim()
	    				var birth = $('#inputBirth').val()
	    				var height = $('#inputHeight').val()
	    				var weight = $('#inputWeight').val()
	    				
	    				if(height == '' || height == null || height == void 0){
	    					alert('please input your Height.')
	    					return
	    				}
	    				if(weight == '' || weight == null || weight == void 0){
	    					alert('please input your Weight.')
	    					return
	    				}
	    				
	    				
	    				$('.ui-loading-block').addClass("show");
	    				var teamPlayerList = []
	    				
	    				$.each(vm.$data.playerWithTeamsList, function(i,v){
	    					var tp = {}
	    					tp.teamId = v.teamId
	    					tp.playerId = v.playerId
	    					tp.playerNumber = v.teamNumber
	    					tp.position = v.teamPosition
	    					teamPlayerList.push(tp)
	    				})
	    				
	    				var newImageURL = vm.$data.playerItem.playerLogo
	    				var finalSuccessUploadedURL = f$.cache('finalSuccessUploadedURL');
	    				if(finalSuccessUploadedURL && finalSuccessUploadedURL.length>0)
	    					newImageURL = finalSuccessUploadedURL;
	    				
	    				var params = {
	    						playerId: currentPlayer.id,
	    						playerName: playerName,
	    						playerLogo: newImageURL,
	    						playerBirth: birth,
	    						playerHeight: height,
	    						playerWeight: weight,
	    						playerTeamsInfo : teamPlayerList
	    					};
	    				
 	    				f$.updatePlayerAndTeamInfo(vm.$data.domain, vm.$data.suffix, params).done(function(data) {
	    					$('.ui-loading-block').removeClass("show");
	    					
	    					var status = data.status;
	    	    			if(status=='error') {
	    	    				alert(data.message);
	    	    			} else {
	    	    				var newURL = f$.cache('finalSuccessUploadedURL');
	    	    				if(newURL && newURL.length>0)
	    	    					vm.$data.loggedUserAvatar = newURL;
	    	 
	    	    				f$.cache('uesr_current_playerNickName', nickname);
	    	    				f$.cache('finalSuccessUploadedURL','');
	    	    				//alert('save successfully.')
	    	    				
	    	    				 var jsonObj = {
	    	    					"lang": lang,                			
	    	                		"playerId" : currentPlayer.id,
	    	                		"tournamentId":tournamentId,
	    	                	}
	    	    				var json= encodeURIComponent(JSON.stringify(jsonObj))	
	    	                	location.href = vm.$data.domain+'footballer/mobile/match/basketball/bbPlayerDashboard.html'+'?json='+json;		
	    	    				
	    	    			}
	    	    		}); 
	    				
	    			}
	    		}
	    	});
	    	
    		vm.init();
    		$('.ui-loading-block').removeClass("show");
        });
          
</script>
    </body>
</html>