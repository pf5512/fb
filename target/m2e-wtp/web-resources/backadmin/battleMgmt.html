<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8"><![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9"><![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>约战管理</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width">
<link rel="icon" href="../img/analysis/auf_title.png" type="image/x-icon"/>
<link rel="stylesheet" href="../css/fakeLoader.min.css">
<link rel="stylesheet" type="text/css" href="../css/button.min.css">
<link rel="stylesheet" type="text/css" href="../css/justin_common.css">
<link href="../css/jquery-ui.dialog.1.11.4.min.css" rel="stylesheet" type="text/css">

<script src="assets/javascripts/1.3.0/adminflare-demo-init.min.js"
	type="text/javascript"></script>

<script type="text/javascript">
	// Include Bootstrap stylesheet 
	document
			.write('<link href="assets/css/' + DEMO_ADMINFLARE_VERSION + '/' + DEMO_CURRENT_THEME + '/bootstrap.min.css" media="all" rel="stylesheet" type="text/css" id="bootstrap-css">');
	// Include AdminFlare stylesheet 
	document
			.write('<link href="assets/css/' + DEMO_ADMINFLARE_VERSION + '/' + DEMO_CURRENT_THEME + '/adminflare.min.css" media="all" rel="stylesheet" type="text/css" id="adminflare-css">');
</script>

<script src="assets/javascripts/1.3.0/modernizr-jquery.min.js"
	type="text/javascript"></script>
<script src="assets/javascripts/1.3.0/adminflare-demo.min.js"
	type="text/javascript"></script>
<script src="assets/javascripts/1.3.0/bootstrap.min.js"
	type="text/javascript"></script>
<script src="assets/javascripts/1.3.0/adminflare.min.js"
	type="text/javascript"></script>
<script src="assets/javascripts/vue.min.js" type="text/javascript"></script>
<script src="../js/jquery-1.11.2.min.js" type="text/javascript"></script>
<script src="../js/justin_common.js" type="text/javascript"></script>
<script src="../mobile/js/lib/underscore-min.js" type="text/javascript"></script>
<script src="../js/fakeLoader.min.js" type="text/javascript"></script>
<script src="../js/jquery-ui.dialog.1.11.4.min.js" type="text/javascript"></script>

<style type="text/css">
.well, .box {
	padding-bottom: 0;
}
</style>

<script type="text/javascript">
	$(document).ready(function() {
		prettyPrint();
	});
</script>
</head>
<body>
	<div id="fakeLoader"></div>
	<script type="text/javascript">
		demoSetBodyLayout();
	</script>
	<!-- Main navigation bar
		================================================== -->
	<header class="navbar navbar-fixed-top" id="main-navbar">
		<div class="navbar-inner">
			<div class="container">
				<img id="arenaLogo" onerror="this.style.display='none'"  style="float: left;margin: 6px 0px 0px 5px;width: 28px;height: 28px;">
				<a class="logo"
					style="width: 200px;color: cornsilk; font-size: 15px;font-weight: bold; margin: 10px 8px 0px 8px;">Auf-Backend</a>
				<a class="btn nav-button collapsed" data-toggle="collapse"
					data-target=".nav-collapse"> <span class="icon-reorder"></span>
				</a>

				<div class="nav-collapse collapse">
					<ul class="nav">
						<li class="active">
							<a href="/footballer/backadmin/fieldReservation.html">预定</a></li>
						<li class="complete">
							<a href="/footballer/backadmin/battleMgmt.html" style="color: greenyellow;">约战</a></li>
						<li class="complete">
							<a href="/footballer/backadmin/soloMgmt.html" style="color: aqua;">单飞</a></li>
						<li class="divider-vertical"></li>
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown">管理<i class=" icon-caret-down"></i></a>
							<ul class="dropdown-menu">
								<li><a href="/footballer/backadmin/memberList.html">会员</a></li>
								<li><a href="/footballer/backadmin/nonmemberList.html">用户</a></li>
								<li><a href="/footballer/backadmin/fieldManagement.html">场次/价格</a></li>
								<li class="divider"></li>
								<li class="nav-header">高级功能</li>
								<li><a href="/footballer/backadmin/dataStatistics.html">数据统计</a></li>
								<li><a href="/footballer/backadmin/automationConfig.html">固定场次自动预定</a></li>
							</ul></li>
						<li class="divider-vertical"></li>
					</ul>
					<!-- <form class="navbar-search pull-left" action="" _lpchecked="1">
						<input type="text" class="search-query" placeholder="Search" style="width: 120px">
					</form> -->
					<ul class="nav pull-right">
						<li>
							<!-- <ul class="messages">
								<li><a href="#"><i class="icon-warning-sign"></i> 2<span class="responsive-text"> alerts</span></a></li>
								<li><a href="#"><i class="icon-envelope"></i> 25<span class="responsive-text"> new messages</span></a></li>
							</ul> -->
						</li>
						<li class="separator"></li>
						<li class="dropdown">
							<img onerror="this.style.display='none'" class="headIcon" src="../img/common/admin_spy.png" style="margin: 3px 0 0 1px;">
							<a href="#" class="dropdown-toggle usermenu" data-toggle="dropdown"> 
								<span id="adminName" style="width: 100px;display: block;">管理员名</span>
							</a>
							<ul class="dropdown-menu">
								<li><a onclick="updatePwdPopup();" href="#">修改密码</a></li>
								<!-- <li><a href="#">设置</a></li> -->
								<li class="divider"></li>
								<li><a onclick="loginOut();" href="/footballer/backadmin/fieldReservation.html" >登出</a></li>
							</ul>
					</ul>
				</div>
			</div>
		</div>
	</header>
	
	<div id="app">
	<!-- <div id="app"  @dragover="allowDrop" @drop="removeDrop"> -->
	
	<div id="dialog-form" title="请先登陆"  style="display:none;">
		  <p class="validateTips"></p>
		 
		  <form>
		    <fieldset>
		      <div class="HBox">
		      	<label for="name">用户</label>
		      	<input type="text" name="name" id="name"  class="text ui-widget-content ui-corner-all">
		      </div>
		      <br>
		      <div class="HBox">
		      	<label for="password">密码</label>
		      	<input type="password" name="password" id="password"  class="text ui-widget-content ui-corner-all">
		      </div>
		      <!-- Allow form submission with keyboard without duplicating the dialog button -->
		      <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
		    </fieldset>
		  </form>
	</div>
	
	<div id="dialog-updatePwd" title="修改密码"  style="display:none;">
		  <p class="validateTips"></p>
		 
		  <form>
		    <fieldset>
		      <div class="HBox">
		      	<label for="newPwd" class="forInput">新密码</label>
		      	<input type="password" name="newPwd" id="newPwd"  class="text ui-widget-content ui-corner-all">
		      </div>
		      <br>
		      <div class="HBox">
		      	<label for="confirmPwd" class="forInput">确认密码</label>
		      	<input type="password" name="confirmPwd" id="confirmPwd"  class="text ui-widget-content ui-corner-all">
		      </div>
		      <!-- Allow form submission with keyboard without duplicating the dialog button -->
		      <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
		    </fieldset>
		  </form>
	</div>
	
	<div id="dialog-battleConfirm" title="约战详情"  style="display:none;">
		 
		  <form>
		    <fieldset>
		      <p class="battleTips"></p>
		      <table>
		      	<tr>
		      		<td style="width: 44px;"><label for="name">时间</label></td>
		      		<td><label id="battleTimeInfo" for="name"/></td>
		      	</tr>
		      	<tr>
		      		<td><label for="name">场地</label></td>
		      		<td>
		      			<select style="font-size: 14px;" v-on:change="fieldSelectChange">
							<option value="0">请选择可用场地</option>
                        	<option v-for="item in avaliableFieldsList" id="{{item.fcsId}}" value="{{item.fieldId}}">{{item.fieldName}}</option>
						</select>
		      		</td>
		      	</tr>
		      	<tr>
		      		<td><label for="name">球队</label></td>
		      		<td id="team1"></td>
		      	</tr>
		      	<tr style="height: 80px;">
		      		<td><label for="name">球队</label></td>
		      		<td id="team2"></td>
		      	</tr>
		      </table>
		      <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
		    </fieldset>
		  </form>
	</div>


	<section class="container" >

		<section class="row-fluid" style="width: 1125px;">
			<h3 class="box-header">
				<img onerror="this.style.display='none'" class="headIcon" src="../img/backend/battle_100_120.png" style="margin: -7px 10px 0px 0px;">
				约战管理
			</h3>
			<div class="box">
				<div class="HBox" style="width:100%">
					<div style="margin-right:60px;width:33%;">
					<h4 style="padding: 0px 0px 0px 5px;display: inline-flex;">
						<img onerror="this.style.display='none'" class="headIcon" src="../img/common/userIcon.png" style="margin: -7px 10px 0px 0px;">
						球场常用约战用户
						<label>(根据使用频次排序)</label>
					</h4>
					</div>
					<div class="HBox" style="width:67%;display: block;">
						<div class="left">
							<h4 style="padding: 0px 0px 0px 5px;color: darkgreen;display: inline-flex;">
								<img onerror="this.style.display='none'" class="headIcon" src="assets/images/wechatpaid_yue.png" style="margin: -7px 10px 0px 0px;">
								微信用户约战需求
								<label>(微信端收集)</label>	
							</h4>
						</div>
						
						<div class="button-group right">
							<button v-on:click="showAllday" type="button" class="button button-pill button-small button-highlight">全天</button>
				    		<button v-on:click="showEvening" type="button" class="button button-pill button-small button-royal">晚上</button>
						</div>
					</div>
				</div>
				
				<div class="HBox" >
				
					<!-- 常用约场客户 -->
					<div id="backendBattleUserArea" style="border: aliceblue 3px solid; margin-right:60px;width:33%;height:550px; overflow-x:hidden;overflow-y:auto;"> 
						<div class="HBox" style="font-weight: 500;color: dodgerblue; background-color: aliceblue;width:101%;padding: 5px;">
							<span style="width:140px; padding-left:5px;">
							<label style="width: 130px;text-align: left;font-weight: 500;">球员头像名字</label>
							</span>
							<label style="width: 80px;text-align: left;padding-right:5px;font-weight: 500;">队名</label>
							<label style="width: 80px;text-align: left;padding-right:20px;font-weight: 500;">电话</label>
							<!-- <label style="width: 52px;text-align: right;padding-right:5px;font-weight: 500;">使用次数</label> -->
						</div><br><br>
						
						
						<template v-for="row in battleActiveCustomers">
							<div class="HBox" name="backendTeam" data-playerid="{{row.playerId}}" data-teamId="{{row.teamId}}" draggable="true" style="height: 40px;" 
								  @dragstart="dragBackendTeamItem" 
								  onmouseover="mouseOver(this)" onmouseout="mouseOut(this)">
								
								<!-- <img onerror="this.style.display='none'" class="teamIcon" src="http://static.footballer.cc/{{row.teamLogo}}" style="margin: -7px 10px 0px 0px;"> -->
								
								<span class="child-elements" style="width:140px; padding-left:5px;">
									<div v-if="row.playerHeadIcon">
										<img onerror="this.style.display='none'" class="headIcon" src="{{row.playerHeadIcon}}" style="margin: -7px 10px 0px 0px;">
									</div>	
									<label style="width: 130px;text-align: left;">{{row.playerName}}</label>
								</span>
								
								<label class="child-elements" style="width: 80px;text-align: left;padding-right:5px;">{{row.teamName}}</label>
								<label class="child-elements" style="width: 80px;text-align: left;padding-right:20px;">{{row.cellphone}}</label>
								<!-- <label style="width: 52px;text-align: right;padding-right:5px;">{{row.useTimes}}次</label> -->								
							</div>
						</template>					
					</div>
					
					<!-- 微信约战 -->
					<div id="wechatBattleWishArea" style="width:67%; height:553px; overflow-y:auto; border: aliceblue 3px solid;" draggable="true">
						<template v-for="row in battleWishList">
								<li class="HBox" style="padding: 5px 0px 5px 5px; width: 100%;background-color: aliceblue;color: dodgerblue;margin-bottom:10px;">
									<label style="width: 120px;font-size: 16px;padding-left:5px;">{{row.displayDate}}</label>
									<label style="width: 120px;font-size: 16px;">{{row.week}}</label>
								</li>
								<br>
								<template v-for="item in row.displayDateTimeList">
									<li style="display: inline-flex;width:100%;">
									<span style="padding: 4px 10px 0px 10px;font-size: 15px;display: inline-flex;">
										<i class="icon-caret-right" style="padding-right:10px;"></i>
										{{item.displayDateTime}}
									</span>
									<!-- <img onerror="this.style.display='none'" class="teamIcon" src="{{row.teamLogo}}" style="margin: -7px 10px 0px 0px;"> -->
									<span style="margin-left: 20px;width:100%;" 
										  data-displayDate="{{row.displayDate}}" data-disPlayDateTime="{{item.displayDateTime}}" data-week="{{row.week}}"
									       @dragover="allowDrop" @dragenter="dragenter" @dragleave="dragleave"  @drop="dropTeamHere">
										<template v-for="playerTeamInfo in item.playerTeamInfoList">
										<div v-if="playerTeamInfo.playerId" name="weChatTeam" class="HBox" draggable="true" style="height: 40px;" 
												data-id="{{playerTeamInfo.battleWishId}}"
												data-playerId="{{playerTeamInfo.playerId}}" data-teamId="{{playerTeamInfo.teamId}}" data-date="{{playerTeamInfo.date}}"
												data-displayDate="{{playerTeamInfo.displayDate}}" data-disPlayDateTime="{{playerTeamInfo.disPlayDateTime}}" data-week="{{playerTeamInfo.week}}"
												onmouseover="mouseOver(this)" onmouseout="mouseOut(this)"
												@dragstart="dragWeChatTeamItem" @dragover="allowDrop" @dragenter="dragenter" @dragleave="dragleave" @drop="dropBattle">
											<span style="width:140px; padding-left:5px;" class="child-elements">
												<div v-if="playerTeamInfo.playerHeadIcon">
													<img onerror="this.style.display='none'" class="headIcon" src="{{playerTeamInfo.playerHeadIcon}}" style="margin: -7px 10px 0px 0px;">
												</div>	
												<label style="width: 130px;text-align: left;">{{playerTeamInfo.playerName}}</label>
											</span>
											<label class="child-elements" style="width: 80px;text-align: left;padding-right:5px;">{{playerTeamInfo.teamName}}</label>
											<label class="child-elements" style="width: 80px;text-align: left;padding-right:20px;">{{playerTeamInfo.cellphone}}</label>
											<div v-if="playerTeamInfo.battleWishId">
												<a v-on:click="removeBtn" data-id="{{playerTeamInfo.battleWishId}}" class="button button-circle button-caution button-tiny" style="display:none;margin-top: -4px;">x</a>
											</div>
											
										</div>
										</template>
									</span>
									
									</li>
									<br>
								</template>
								<br>
						</template>
					</div>
				</div>	
			</div>
		</section>


		<!-- Page footer
			================================================== -->
		<footer id="main-footer">
			Copyright © 2015 <!-- <a href="http://www.footballer.cc"> -->成都傲赴体育有限公司 
			all rights reserved. <a href="#" class="pull-right" id="on-top-link">
				On Top &nbsp;<i class="icon-chevron-up"></i>
			</a>
		</footer>
		<!-- / Page footer -->
	</section>
	</div>
</body>
<script type="text/javascript">
	(function() {
		var arenaId;
		var amId
		var urlPre ='',iaa='';
		
		var vm = new Vue(
				{
					el : '#app',

					data : {
						battleActiveCustomers : [],
						battleWishList:[],
						bwDayList:[],
						bwEveningList:[],
						avaliableFieldsList:[],
						selectedFieldId:null,
						selectedStartTime:null,
						selectedUseDate:null,
						selectedPlayerId:null,
						selectedTargetPlayerId:null,
						selectedBattleWishId:null,
						selectedTargetBattleWishId:null
					},
					watch : {},
					methods : {
						init:function(){
							arenaId = window.localStorage["arenaId"];
							urlPre = window.localStorage["urlPre"]
					 		iaa = window.localStorage["iaa"]

							vm.$data.getBattleAcitveCustomersUrl = urlPre+'battle-service/findBattleActiveCustomersOrderByTimes/'+ arenaId +iaa
							vm.$data.getbattleWishListUrl = urlPre+'battle-service/findWeChatBattleWishs/'+ arenaId +iaa
							vm.$data.removeBattleWishUrl = urlPre+'battle-service/removeWeChatBattleWish'+iaa
							vm.$data.getAvaliableListUrl = urlPre+'battle-service/getAvaliableFieldsOfDay'+iaa
							vm.$data.arenaOwnerAddBattleReservationUrl = urlPre+'battle-service/arenaOwnerAddBattleReservation'+iaa
						},
						getBattleAcitveCustomers : function() {
							loading();	 
							$.GetJSON(vm.$data.getBattleAcitveCustomersUrl, null,function(data) {
								if (data) {
									vm.$data.battleActiveCustomers = data.battleActiveCustomersList
									hideLoading();
								}
							});  						
 								
							//测试数据
 							//loading();
							/* var temp = {"status":"success","battleActiveCustomersList":[{"playerId":1,"playerName":"来碗豆腐司机","playerHeadIcon":"http://wx.qlogo.cn/mmopen/Q3auHgzwzM6rdkQMtnkDXQ43emrOd02uDoxqosJAr5Aeicy2tzaSXZcuGDmUUpQoiaXJ7gKTe3Yd37KmvbktMvww/0","teamId":1,"teamName":"踢球者","teamLogo":"2015-10/2cc6af62-ee4e-4678-88d2-b3d2e5fbc3ab.png","cellphone":18180629919,"useTimes":47},{"playerId":125,"playerName":"Ian","playerHeadIcon":"http://wx.qlogo.cn/mmopen/3a3QxMHZ8YwzkfHoTRjVBSGUG06sJduZRdc2XUsIpAc9end0lCrWNTHYuySfxlJeYS2bdQOCtaTYetsUogYic1iag5aria4Cjic3/0","teamId":102,"teamName":"team1","teamLogo":null,"cellphone":13880641196,"useTimes":41},{"playerId":100,"playerName":"Ian","playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null,"useTimes":29},{"playerId":84,"playerName":"蒲先生_小胖_每周五20点","playerHeadIcon":null,"teamId":66,"teamName":"银河战舰队","teamLogo":null,"cellphone":18628938602,"useTimes":12},{"playerId":102,"playerName":"Test","playerHeadIcon":null,"teamId":72,"teamName":"","teamLogo":null,"cellphone":13111111111,"useTimes":10},{"playerId":90,"playerName":"张仁数","playerHeadIcon":null,"teamId":71,"teamName":"龙城一号","teamLogo":null,"cellphone":18682655030,"useTimes":7},{"playerId":89,"playerName":"俸先生","playerHeadIcon":null,"teamId":70,"teamName":"一塌糊涂","teamLogo":null,"cellphone":13810000050,"useTimes":6},{"playerId":128,"playerName":"佳","playerHeadIcon":"http://wx.qlogo.cn/mmopen/Wkib1gZwVSA432OT9y4Mb9yEtcPhs6szcTWibIz282OjcyvqKPUtibmJXRcTiaSRWjd7dicb8sISJeACDJIuC8K7jCXNgj26EcWbL/0","teamId":97,"teamName":"老拜仁","teamLogo":null,"cellphone":13999999999,"useTimes":5},{"playerId":139,"playerName":"18123360628","playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null,"useTimes":5},{"playerId":115,"playerName":"佳","playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null,"useTimes":3},{"playerId":109,"playerName":"Turbo 雷宇","playerHeadIcon":null,"teamId":77,"teamName":"SPA","teamLogo":null,"cellphone":18508100871,"useTimes":3},{"playerId":80,"playerName":"万先生","playerHeadIcon":null,"teamId":62,"teamName":"/","teamLogo":null,"cellphone":15882118272,"useTimes":2},{"playerId":116,"playerName":"张锐 Raúl ","playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null,"useTimes":2},{"playerId":69,"playerName":"杨世奇","playerHeadIcon":null,"teamId":51,"teamName":"左脚右脚","teamLogo":null,"cellphone":13568943137,"useTimes":2},{"playerId":117,"playerName":"高云","playerHeadIcon":null,"teamId":1,"teamName":"踢球者","teamLogo":"2015-10/2cc6af62-ee4e-4678-88d2-b3d2e5fbc3ab.png","cellphone":15607777700,"useTimes":2},{"playerId":111,"playerName":"张先生","playerHeadIcon":null,"teamId":79,"teamName":"益佳汽修","teamLogo":null,"cellphone":13540746128,"useTimes":2},{"playerId":119,"playerName":"Comments","playerHeadIcon":null,"teamId":84,"teamName":"Test","teamLogo":null,"cellphone":1,"useTimes":2},{"playerId":73,"playerName":"钟先生","playerHeadIcon":null,"teamId":55,"teamName":"6780聚乐部","teamLogo":null,"cellphone":13555555555,"useTimes":2},{"playerId":129,"playerName":"张锐 Raúl ","playerHeadIcon":"http://wx.qlogo.cn/mmopen/icHPzSiaC4pZiag7yrHfs16YBB9MibhrbxiarWwnXLVVf2dVxCKic7tiag3ZicT0RDoYE4G6U2mh7gAqEjhNFtTJMtTcIpakianOzBISr/0","teamId":102,"teamName":"team1","teamLogo":null,"cellphone":null,"useTimes":2},{"playerId":113,"playerName":"崔先生","playerHeadIcon":null,"teamId":81,"teamName":"中洲控股有限公司","teamLogo":null,"cellphone":18080852501,"useTimes":2},{"playerId":87,"playerName":"薛嵘俊","playerHeadIcon":null,"teamId":4,"teamName":"小菜菜","teamLogo":"2015-10/f70dd4d1-86ff-4d59-bab3-599fdbf365f2.png","cellphone":18321374821,"useTimes":1},{"playerId":11,"playerName":"测试","playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":13550015055,"useTimes":1},{"playerId":86,"playerName":"刘先生","playerHeadIcon":null,"teamId":62,"teamName":"/","teamLogo":null,"cellphone":15928077164,"useTimes":1},{"playerId":79,"playerName":"苏先生","playerHeadIcon":null,"teamId":61,"teamName":"/","teamLogo":null,"cellphone":18782263332,"useTimes":1},{"playerId":159,"playerName":"addnew","playerHeadIcon":null,"teamId":1,"teamName":"踢球者","teamLogo":"2015-10/2cc6af62-ee4e-4678-88d2-b3d2e5fbc3ab.png","cellphone":13001234567,"useTimes":1},{"playerId":157,"playerName":"2","playerHeadIcon":null,"teamId":111,"teamName":"2","teamLogo":null,"cellphone":22222222222,"useTimes":1},{"playerId":67,"playerName":"阿杰","playerHeadIcon":null,"teamId":49,"teamName":"/","teamLogo":null,"cellphone":13222222222,"useTimes":1},{"playerId":101,"playerName":"justinmindtest","playerHeadIcon":"2016-03/2b432968-c1c6-4cd4-ab2e-1ece5c0069d9.png","teamId":1,"teamName":"踢球者","teamLogo":"2015-10/2cc6af62-ee4e-4678-88d2-b3d2e5fbc3ab.png","cellphone":null,"useTimes":1},{"playerId":2,"playerName":"17722630589","playerHeadIcon":null,"teamId":1,"teamName":"踢球者","teamLogo":"2015-10/2cc6af62-ee4e-4678-88d2-b3d2e5fbc3ab.png","cellphone":null,"useTimes":1},{"playerId":52,"playerName":"黄璜","playerHeadIcon":null,"teamId":79,"teamName":"益佳汽修","teamLogo":null,"cellphone":18982063818,"useTimes":1},{"playerId":132,"playerName":"小佳 ","playerHeadIcon":"http://wx.qlogo.cn/mmopen/Wkib1gZwVSA5jnmGria36EWibOuegszyocajQFBMsny0XxaY7gXQbYOHibEmVGvnLQ7LZuj1G5LluNaKq9bX5ibdHbxFLX0IbAxgy/0","teamId":null,"teamName":null,"teamLogo":null,"cellphone":null,"useTimes":1},{"playerId":10,"playerName":"罗贝里","playerHeadIcon":null,"teamId":1,"teamName":"踢球者","teamLogo":"2015-10/2cc6af62-ee4e-4678-88d2-b3d2e5fbc3ab.png","cellphone":13550015054,"useTimes":1},{"playerId":70,"playerName":"陈睿","playerHeadIcon":null,"teamId":72,"teamName":"","teamLogo":null,"cellphone":13808195482,"useTimes":1}]}
							vm._data.battleActiveCustomers = temp.battleActiveCustomersList */
							//hideLoading();  
						},
						getbattleWishList : function() {
							$.GetJSON(vm.$data.getbattleWishListUrl,null,function(data) {
								if (data) {
									vm.$data.battleWishList = data.battleWishList;
									//hideLoading();
									
									var dateArr= []
									var battleWishList = []
									 
									$.each(data.battleWishList, function(i,v){
										dateArr.push(v.displayDate);
									}) 
									dateArr = uniquearr(dateArr);
									
									$.each(dateArr, function(di,dv){
										var timeArr=[];
										var sameDayBattle = _.where(data.battleWishList, {displayDate: dv})
										
										battleWishItem = {}
										battleWishItem.displayDate = dv
										battleWishItem.week =  sameDayBattle[0].week
										
										$.each(sameDayBattle, function(i,v){
											timeArr.push(v.disPlayDateTime)
										})
										timeArr = uniquearr(timeArr);
										var displayDateTimeList = [];
										$.each(timeArr, function(ti,tv){
											var displayDateTimeItem = {}
											displayDateTimeItem.displayDateTime= tv
											
											var sameTimeBattle = _.where(sameDayBattle, {disPlayDateTime: tv})
											var playerTeamInfoList = [];
											$.each(sameTimeBattle, function(stbI,stbV){
												var playerTeamInfo ={}
												playerTeamInfo.battleWishId = stbV.id
												playerTeamInfo.date = stbV.date
												playerTeamInfo.playerId= stbV.playerId
												playerTeamInfo.playerName= stbV.playerName
												playerTeamInfo.playerHeadIcon= stbV.playerHeadIcon
												playerTeamInfo.teamId= stbV.teamId
												playerTeamInfo.teamName= stbV.teamName
												playerTeamInfo.teamLogo= stbV.teamLogo
												playerTeamInfo.cellphone= stbV.cellphone
												playerTeamInfo.displayDate= stbV.displayDate
												playerTeamInfo.disPlayDateTime= stbV.disPlayDateTime
												playerTeamInfo.week= stbV.week
												playerTeamInfoList.push(playerTeamInfo)
											})
											
											displayDateTimeItem.playerTeamInfoList = playerTeamInfoList
											displayDateTimeList.push(displayDateTimeItem)
										})
										battleWishItem.displayDateTimeList= displayDateTimeList
										battleWishList.push(battleWishItem)
									}) 
									 
									vm.$data.bwDayList = battleWishList
									
									vm.$data.bwEveningList = [];
									$.each(battleWishList, function(i,v){
										
										
										battleWishItem = {}
										battleWishItem.displayDate = v.displayDate
										battleWishItem.week =  v.week
										battleWishItem.displayDateTimeList=[]                     
										
										$.each(v.displayDateTimeList, function(index,value){
											if(value.displayDateTime.substring(0,2) >=18){	
												var displayDateTimeItem = {}
												displayDateTimeItem.displayDateTime= value.displayDateTime
												displayDateTimeItem.playerTeamInfoList = value.playerTeamInfoList
												battleWishItem.displayDateTimeList.push(displayDateTimeItem)
											}	
										})
										
										vm.$data.bwEveningList.push(battleWishItem)
									});

									//默认为只显示晚上
									vm._data.battleWishList = vm.$data.bwEveningList;
								}
							});
							
							//测试数据
							/* var temp = {"status":"success","battleWishList":[{"id":null,"arenaId":null,"date":1468630800000,"displayDate":"2016-07-16","disPlayDateTime":"09:00","week":"星期六","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468641600000,"displayDate":"2016-07-16","disPlayDateTime":"12:00","week":"星期六","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468648800000,"displayDate":"2016-07-16","disPlayDateTime":"14:00","week":"星期六","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468656000000,"displayDate":"2016-07-16","disPlayDateTime":"16:00","week":"星期六","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468663200000,"displayDate":"2016-07-16","disPlayDateTime":"18:00","week":"星期六","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":28,"arenaId":null,"date":1468668600000,"displayDate":"2016-07-16","disPlayDateTime":"19:30","week":"星期六","playerId":100,"playerName":"Ian","playerHeadIcon":null,"teamId":1,"teamName":"踢球者","teamLogo":"2015-10/2cc6af62-ee4e-4678-88d2-b3d2e5fbc3ab.png","cellphone":null},{"id":52,"arenaId":null,"date":1468668600000,"displayDate":"2016-07-16","disPlayDateTime":"19:30","week":"星期六","playerId":125,"playerName":"Ian","playerHeadIcon":"http://wx.qlogo.cn/mmopen/3a3QxMHZ8YwzkfHoTRjVBSGUG06sJduZRdc2XUsIpAc9end0lCrWNTHYuySfxlJeYS2bdQOCtaTYetsUogYic1iag5aria4Cjic3/0","teamId":102,"teamName":"team1","teamLogo":null,"cellphone":13880641196},{"id":53,"arenaId":null,"date":1468668600000,"displayDate":"2016-07-16","disPlayDateTime":"19:30","week":"星期六","playerId":1,"playerName":"来碗豆腐司机","playerHeadIcon":"http://wx.qlogo.cn/mmopen/Q3auHgzwzM6rdkQMtnkDXQ43emrOd02uDoxqosJAr5Aeicy2tzaSXZcuGDmUUpQoiaXJ7gKTe3Yd37KmvbktMvww/0","teamId":1,"teamName":"踢球者","teamLogo":"2015-10/2cc6af62-ee4e-4678-88d2-b3d2e5fbc3ab.png","cellphone":18180629919},{"id":null,"arenaId":null,"date":1468674000000,"displayDate":"2016-07-16","disPlayDateTime":"21:00","week":"星期六","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468717200000,"displayDate":"2016-07-17","disPlayDateTime":"09:00","week":"星期日","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468728000000,"displayDate":"2016-07-17","disPlayDateTime":"12:00","week":"星期日","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468735200000,"displayDate":"2016-07-17","disPlayDateTime":"14:00","week":"星期日","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468742400000,"displayDate":"2016-07-17","disPlayDateTime":"16:00","week":"星期日","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468749600000,"displayDate":"2016-07-17","disPlayDateTime":"18:00","week":"星期日","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468755000000,"displayDate":"2016-07-17","disPlayDateTime":"19:30","week":"星期日","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468760400000,"displayDate":"2016-07-17","disPlayDateTime":"21:00","week":"星期日","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468803600000,"displayDate":"2016-07-18","disPlayDateTime":"09:00","week":"星期一","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468814400000,"displayDate":"2016-07-18","disPlayDateTime":"12:00","week":"星期一","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468821600000,"displayDate":"2016-07-18","disPlayDateTime":"14:00","week":"星期一","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468828800000,"displayDate":"2016-07-18","disPlayDateTime":"16:00","week":"星期一","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468836000000,"displayDate":"2016-07-18","disPlayDateTime":"18:00","week":"星期一","playerId":125,"playerName":"Ian","playerHeadIcon":"http://wx.qlogo.cn/mmopen/3a3QxMHZ8YwzkfHoTRjVBSGUG06sJduZRdc2XUsIpAc9end0lCrWNTHYuySfxlJeYS2bdQOCtaTYetsUogYic1iag5aria4Cjic3/0","teamId":102,"teamName":"team1","teamLogo":null,"cellphone":13880641196},{"id":null,"arenaId":null,"date":1468841400000,"displayDate":"2016-07-18","disPlayDateTime":"19:30","week":"星期一","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468846800000,"displayDate":"2016-07-18","disPlayDateTime":"21:00","week":"星期一","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468890000000,"displayDate":"2016-07-19","disPlayDateTime":"09:00","week":"星期二","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468900800000,"displayDate":"2016-07-19","disPlayDateTime":"12:00","week":"星期二","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468908000000,"displayDate":"2016-07-19","disPlayDateTime":"14:00","week":"星期二","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468915200000,"displayDate":"2016-07-19","disPlayDateTime":"16:00","week":"星期二","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468922400000,"displayDate":"2016-07-19","disPlayDateTime":"18:00","week":"星期二","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468927800000,"displayDate":"2016-07-19","disPlayDateTime":"19:30","week":"星期二","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468933200000,"displayDate":"2016-07-19","disPlayDateTime":"21:00","week":"星期二","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468976400000,"displayDate":"2016-07-20","disPlayDateTime":"09:00","week":"星期三","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468987200000,"displayDate":"2016-07-20","disPlayDateTime":"12:00","week":"星期三","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1468994400000,"displayDate":"2016-07-20","disPlayDateTime":"14:00","week":"星期三","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1469001600000,"displayDate":"2016-07-20","disPlayDateTime":"16:00","week":"星期三","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1469008800000,"displayDate":"2016-07-20","disPlayDateTime":"18:00","week":"星期三","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1469014200000,"displayDate":"2016-07-20","disPlayDateTime":"19:30","week":"星期三","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1469019600000,"displayDate":"2016-07-20","disPlayDateTime":"21:00","week":"星期三","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1469062800000,"displayDate":"2016-07-21","disPlayDateTime":"09:00","week":"星期四","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1469073600000,"displayDate":"2016-07-21","disPlayDateTime":"12:00","week":"星期四","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1469080800000,"displayDate":"2016-07-21","disPlayDateTime":"14:00","week":"星期四","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1469088000000,"displayDate":"2016-07-21","disPlayDateTime":"16:00","week":"星期四","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1469095200000,"displayDate":"2016-07-21","disPlayDateTime":"18:00","week":"星期四","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1469100600000,"displayDate":"2016-07-21","disPlayDateTime":"19:30","week":"星期四","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1469106000000,"displayDate":"2016-07-21","disPlayDateTime":"21:00","week":"星期四","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1469149200000,"displayDate":"2016-07-22","disPlayDateTime":"09:00","week":"星期五","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1469160000000,"displayDate":"2016-07-22","disPlayDateTime":"12:00","week":"星期五","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1469167200000,"displayDate":"2016-07-22","disPlayDateTime":"14:00","week":"星期五","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1469174400000,"displayDate":"2016-07-22","disPlayDateTime":"16:00","week":"星期五","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1469181600000,"displayDate":"2016-07-22","disPlayDateTime":"18:00","week":"星期五","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1469187000000,"displayDate":"2016-07-22","disPlayDateTime":"19:30","week":"星期五","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null},{"id":null,"arenaId":null,"date":1469192400000,"displayDate":"2016-07-22","disPlayDateTime":"21:00","week":"星期五","playerId":null,"playerName":null,"playerHeadIcon":null,"teamId":null,"teamName":null,"teamLogo":null,"cellphone":null}]}
							var dateArr= []
							var battleWishList = []
							 
							$.each(temp.battleWishList, function(i,v){
								dateArr.push(v.displayDate);
							}) 
							dateArr = uniquearr(dateArr);
							
							$.each(dateArr, function(di,dv){
								var timeArr=[];
								var sameDayBattle = _.where(temp.battleWishList, {displayDate: dv})
								
								battleWishItem = {}
								battleWishItem.displayDate = dv
								battleWishItem.week =  sameDayBattle[0].week
								
								$.each(sameDayBattle, function(i,v){
									timeArr.push(v.disPlayDateTime)
								})
								timeArr = uniquearr(timeArr);
								var displayDateTimeList = [];
								$.each(timeArr, function(ti,tv){
									var displayDateTimeItem = {}
									displayDateTimeItem.displayDateTime= tv
									
									var sameTimeBattle = _.where(sameDayBattle, {disPlayDateTime: tv})
									var playerTeamInfoList = [];
									$.each(sameTimeBattle, function(stbI,stbV){
										var playerTeamInfo ={}
										playerTeamInfo.battleWishId = stbV.id
										playerTeamInfo.date = stbV.date
										playerTeamInfo.playerId= stbV.playerId
										playerTeamInfo.playerName= stbV.playerName
										playerTeamInfo.playerHeadIcon= stbV.playerHeadIcon
										playerTeamInfo.teamId= stbV.teamId
										playerTeamInfo.teamName= stbV.teamName
										playerTeamInfo.teamLogo= stbV.teamLogo
										playerTeamInfo.cellphone= stbV.cellphone
										playerTeamInfo.displayDate= stbV.displayDate
										playerTeamInfo.disPlayDateTime= stbV.disPlayDateTime
										playerTeamInfo.week= stbV.week
										playerTeamInfoList.push(playerTeamInfo)
									})
									
									displayDateTimeItem.playerTeamInfoList = playerTeamInfoList
									displayDateTimeList.push(displayDateTimeItem)
								})
								battleWishItem.displayDateTimeList= displayDateTimeList
								battleWishList.push(battleWishItem)
							}) 
							 
							vm.$data.bwDayList = battleWishList
							
							vm.$data.bwEveningList = [];
							$.each(battleWishList, function(i,v){
								
								
								battleWishItem = {}
								battleWishItem.displayDate = v.displayDate
								battleWishItem.week =  v.week
								battleWishItem.displayDateTimeList=[]                     
								
								$.each(v.displayDateTimeList, function(index,value){
									if(value.displayDateTime.substring(0,2) >=18){	
										var displayDateTimeItem = {}
										displayDateTimeItem.displayDateTime= value.displayDateTime
										displayDateTimeItem.playerTeamInfoList = value.playerTeamInfoList
										battleWishItem.displayDateTimeList.push(displayDateTimeItem)
									}	
								})
								
								vm.$data.bwEveningList.push(battleWishItem)
							});

							//默认为只显示晚上
							vm._data.battleWishList = vm.$data.bwEveningList; */
						},
						showAllday:function(e){
							vm._data.battleWishList = vm.$data.bwDayList
						},
						showEvening:function(e){
							vm._data.battleWishList = vm.$data.bwEveningList;
						},
						removeBtn:function(e){
							//console.log(e);
							var removeBattleWishId = e.target.getAttribute('data-id')
							if(removeBattleWishId){
								var parameter = {
									battleWishId : removeBattleWishId
								}

								//loading();
								$.postJSON(vm.$data.removeBattleWishUrl, parameter, function(data) {
									
									if(data.status == 'success'){   		
										vm.removeListItemBybwId(removeBattleWishId)
									}
					 			});
	
							} 
						},
						removeListItemBybwId: function(removeBattleWishId){
							//即时从展示列表移除当前数据
							$.each(vm.$data.bwDayList, function(i,v){
								$.each(v.displayDateTimeList,function(i,v2){
									$.each(v2.playerTeamInfoList,function(i,v3){
										if(v3.battleWishId == removeBattleWishId){
											v3.battleWishId = null
											v3.playerId= null
											v3.playerName= null
											v3.playerHeadIcon= null
											v3.teamId= null
											v3.teamName= null
											v3.teamLogo= null
											v3.cellphone= null
											return false
										}	
									})
								})
							})
							
							$.each(vm.$data.bwEveningList, function(i,v){
								$.each(v.displayDateTimeList,function(i,v2){
									$.each(v2.playerTeamInfoList,function(i,v3){
										if(v3.battleWishId == removeBattleWishId){
											v3.battleWishId = null
											v3.playerId= null
											v3.playerName= null
											v3.playerHeadIcon= null
											v3.teamId= null
											v3.teamName= null
											v3.teamLogo= null
											v3.cellphone= null
											return false
										}	
									})
								})
							})
						},
						getAvaliableList: function(){
							var parameter = {
									arenaId:arenaId,
									startTime:vm.$data.selectedStartTime,
									useDate:vm.$data.selectedUseDate,
									playerId:vm.$data.selectedPlayerId,
									targetPlayerId:vm.$data.selectedTargetPlayerId
								}
							
							$.postJSON(vm.$data.getAvaliableListUrl, parameter,function(data) {
								if (data) {
									vm.$data.avaliableFieldsList = data.avaliableFieldsList
								}
							});  	
						},
						dragBackendTeamItem: function(ev) {
							playerId = ev.target.getAttribute('data-playerid')
							ev.dataTransfer.setData("type", 'backendUser');
							ev.dataTransfer.setData("playerId", playerId);
						},
						dragWeChatTeamItem : function(ev){
							playerId = ev.target.getAttribute('data-playerid')
							ev.dataTransfer.setData("type", 'wechatUser');
							ev.dataTransfer.setData("playerId", playerId);
						},
						allowDrop :function(ev) {
							ev.preventDefault();
						},
						dragenter: function(ev){
							ev.preventDefault();
							$(ev.target).css('border','dodgerblue 1px dashed')
						},
						dragleave: function(ev){
							ev.preventDefault();
							$(ev.target).css('border','none')
						},
						backendItemDoubleClick:function(e){
							$(e.target).prev().remove()
							$(e.target).remove()							
						},
						//将其他球队拖入约战意愿列表
						dropTeamHere: function(ev){
							ev.preventDefault();
							ev.stopPropagation()//避免父类冒泡出发拖拽处理函数
							$(ev.target).css('border','none')
							
							var ItemType = ev.dataTransfer.getData("type");
							var dragFromPlayerId = ev.dataTransfer.getData("playerId");
							var dropArea = $(ev.target).clone()

				    		vm.$data.selectedStartTime = dropArea.attr('data-displayDateTime')+':00'
					    	vm.$data.selectedUseDate = dropArea.attr('data-displayDate')
					    	vm.$data.selectedWeek = dropArea.attr('data-week')	
					    	
					    	wechatItem = $('#wechatBattleWishArea').find("div[data-playerid='"+dragFromPlayerId+"']") 
				    		backendItem = $('#backendBattleUserArea').find("div[data-playerid='"+dragFromPlayerId+"']")
					    	
					    	if(ItemType=='wechatUser'){
					    		if(wechatItem.length ==1){
					    			dragFromElement = wechatItem.clone();	
					    			//dragFromElement.on('drop',vm.dragWeChatTeamItem);
					    		}else if (wechatItem.length>1)//避免重复取多次
					    		{
					    			dragFromElement = $(wechatItem[0]).clone()
					    			//dragFromElement.on('drop',vm.dragWeChatTeamItem);
					    		}
					    		wechatItem.remove();
					    		dragFromElement.find('a').on('click',function(e)
					    			{ 
					    			$(e.target).parents("div[name='weChatTeam']").prev().remove()
					    			$(e.target).parents("div[name='weChatTeam']").remove()
					    			});
				    		}
				    		if(ItemType=='backendUser'){
				    			dragFromElement = backendItem.clone();
				    			//dragFromElement.on('drop',vm.dragBackendTeamItem);
				    			dragFromElement.on('dblclick',vm.backendItemDoubleClick);
				    		}
				    		dragFromElement.on('drop',vm.dropBattle);//微信球队增加特定约战函数
							$(ev.target).append('<br>').append(dragFromElement);//加入当前拖动球队到列表
						},
						//直接拖到某个约战意愿列表中的球队上
						dropBattle: function(ev) {
				            ev.preventDefault()
				            ev.stopPropagation()//避免父类冒泡出发拖拽处理函数
				            $(ev.target).css('border','none')
				            
				            var dragFromData,dragFromPlayerId,ItemType,dragToElement
				            var dragToArea = $(ev.target.parentElement).clone()
				            var dragToPlayerId = ev.target.getAttribute('data-playerid')
				    		if(ev.dataTransfer){
				    			dragFromData = ev.dataTransfer
				    		}else if(ev.originalEvent.dataTransfer){
				            	dragFromData = ev.originalEvent.dataTransfer
				            }
				            dragFromPlayerId = dragFromData.getData("playerId");
			    			ItemType = dragFromData.getData("type");//被拖入元素的分类（后台用户，微信用户）
				    		
			    			if(dragFromPlayerId == dragToPlayerId){ //自己和自己不约
				    			return
				    		}
				    		
			    			dragToItemName = ev.target.getAttribute('name')
			    			
				    		if(dragToItemName=='backendTeam'){
				    			dragToElement = $(ev.target).clone()
				    		}
				    		if(dragToItemName=='weChatTeam'){
				    			temp = $(ev.target).clone()
					    		temp.find('a').remove()//展示时移除删除按钮
					    		dragToElement = temp
				    		}
					    		
				    		vm.$data.selectedStartTime = dragToArea.attr('data-displayDateTime')+':00'
					    	vm.$data.selectedUseDate = dragToArea.attr('data-displayDate')
					    	vm.$data.selectedWeek = dragToArea.attr('data-week')	
				    		vm.$data.selectedPlayerId = dragFromPlayerId
				    		vm.$data.selectedTargetPlayerId = dragToPlayerId
				    		vm.$data.selectedBattleWishId = ev.target.getAttribute('data-id')
				    		
				    		wechatItem =$('#wechatBattleWishArea').find("div[data-playerid='"+dragFromPlayerId+"']") 
				    		backendItem = $('#backendBattleUserArea').find("div[data-playerid='"+dragFromPlayerId+"']")
				    		
				    		if(ItemType=='wechatUser'){
				    			if(wechatItem.length ==1){
					    			dragFromElement = wechatItem.clone();		
					    		}else if (wechatItem.length>1)//避免重复取多次
					    		{
					    			dragFromElement = $(wechatItem[0]).clone()
					    		} 
				    		}
				    		if(ItemType=='backendUser'){
				    			dragFromElement = backendItem.clone();
				    		}
				    		
				    		vm.$data.selectedTargetBattleWishId = dragFromElement.attr('data-id')
				    		
				    		//获取当前条件下可用场地列表
				    		vm.getAvaliableList()
				    			
				    		dialog = $( "#dialog-battleConfirm" ).dialog({
				    				closeOnEscape: false,
				    				open: function(event, ui) { $(".ui-dialog-titlebar-close", ui.dialog | ui).hide(); },//前2行 隐去右侧自带得关闭按钮
				    			    autoOpen: true,
				    			    height: 300,
				    		     	width: 450,
				    			    modal: true,
				    			    buttons: {
				    			    	"取消": function() {
				    			        	form[ 0 ].reset();
				    			        	dialog.dialog( "close" );
				    			        	$('#team1').empty()
				    						$('#team2').empty()
				    			    	},
				    			        "预约约战": function(e){
				    			        	vm.arenaOwnerAddBattleReservation(dialog);
				    			        }
				    			    },
				    			    close: function() {
				    			        form[ 0 ].reset();
				    			    }
				    		});	
				    			
				    		form = dialog.find( "form" ).on( "submit", function( event ) {
				    		      event.preventDefault();
				    		 });
				    			
				    		//"2016-07-16" "星期六" "19:30"
				    		var battleTimeInfo= vm.$data.selectedUseDate +' '+ vm.$data.selectedWeek +' '+ vm.$data.selectedStartTime
				    			
				    		$('#battleTimeInfo').text(battleTimeInfo);
				    		$('#team1').append(dragToElement)
				    		$('#team2').append(dragFromElement)
				    		dialog.dialog( "open" );
				        },
				        /* removeDrop: function(ev){
				    		ev.preventDefault();
				    		dragFromElement.remove();
				    	}, */
				        fieldSelectChange : function(e){
				        	if(e.target.value == 0){
				        		return
				        	}else{
				        		vm.$data.selectedFieldId = e.target.value
				        		vm.$data.selectedFcsId = $(e.target).find("option[value='"+e.target.value+"']").attr('id')
				        	}
						},
						arenaOwnerAddBattleReservation : function(dialog) {
							
							if(vm.$data.selectedFieldId == null){
								alert('请选择可用场地')
								return
							}
							
							dragToBattleWishId= vm.$data.selectedBattleWishId
							dragFromBattleWishId=vm.$data.selectedTargetBattleWishId
							
							//console.log('Looks like you made it!');
							dialog.dialog( "close" );
			    			$('#team1').empty()
			    			$('#team2').empty()
							
							var parameter = {
			    					arenaId:arenaId,
									battleWishId:dragToBattleWishId,
									targetBattleWishId:dragFromBattleWishId,
									fieldId:vm.$data.selectedFieldId,
									fcsId:vm.$data.selectedFcsId,
									playerId:vm.$data.selectedPlayerId,
									guestPlayerId:vm.$data.selectedTargetPlayerId,
									useDate:vm.$data.selectedUseDate
								};

								$.postJSON(vm.$data.arenaOwnerAddBattleReservationUrl, parameter, function(data) {
									if(data.status =='success'){
			    						alert('已完成约战场地预定，请到预定页面查看详情');
											
										//移除之前完成约战的 球队的 约战意愿（微信端的意愿）
										if(dragToBattleWishId){
											vm.removeListItemBybwId(dragToBattleWishId)	
										}
			    			        	if(dragFromBattleWishId){
											vm.removeListItemBybwId(dragFromBattleWishId)	
										}
			    			        	
			    			        	//移除之前完成约战的 处于微信约战意愿区域的（后台约战球队）
			    			        	starttime = vm.$data.selectedStartTime.toString()
			    			        	starttime = starttime.substr(0,starttime.length-3)

			    			        	dragdropspanArea = $('#wechatBattleWishArea').find("span[data-displaydate='"+vm.$data.selectedUseDate+"'][data-displaydatetime='"+starttime+"']")
			    			        	dragdropspanArea.find("div[data-playerid='"+vm.$data.selectedPlayerId+"']").remove()
										dragdropspanArea.find("div[data-playerid='"+vm.$data.selectedTargetPlayerId+"']").remove()
									}else{
										alert('参数有误');
									}		
								});
	
						}
					}
				});

		loginStatusCheck(pageInit);
		 
		function pageInit(){
			loadingInit();
			vm.init()
			vm.getBattleAcitveCustomers()
			vm.getbattleWishList()
			hidesomeloadingpart('theme_switcher');
		}

	})()
	
	 
	function mouseOver(e) {
		$(e).css('background', 'aliceblue');
		$(e).find('label').css('font-size', '14px')
		$(e).find('label').css('color', 'cornflowerblue')
		$(e).find('a').css('display', 'block')

	}

	function mouseOut(e) {
		$(e).css('background', 'transparent');
		$(e).find('label').css('font-size', '13px')
		$(e).find('label').css('color', 'black')
		$(e).find('a').hide()
	}
	
	
	
</script>
</html>