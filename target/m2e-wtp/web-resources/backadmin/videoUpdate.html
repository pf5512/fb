<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8"><![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9"><![endif]-->
<!--[if gt IE 8]><!--><html class="no-js"><!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>
		AdminFlare - Pages - Messages
	</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width">
	<script src="assets/javascripts/vue.min.js" type="text/javascript"></script>
	<script src="../js/jquery-1.11.2.min.js" type="text/javascript"></script>
	<script src="../mobile/js/lib/underscore-min.js" type="text/javascript"></script>
	<script src="assets/javascripts/1.3.0/adminflare-demo-init.min.js" type="text/javascript"></script>	
	<script src="../js/jqBootstrapValidation.js" type="text/javascript"></script>
	<script src="assets/javascripts/axios.js"></script>
	<script src="../i18n/env.js"></script>

	<link href="http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,300,600,700" rel="stylesheet" type="text/css">
	<script type="text/javascript">
		// Include Bootstrap stylesheet 
		document.write('<link href="assets/css/' + DEMO_ADMINFLARE_VERSION + '/' + DEMO_CURRENT_THEME + '/bootstrap.min.css" media="all" rel="stylesheet" type="text/css" id="bootstrap-css">');
		// Include AdminFlare stylesheet 
		document.write('<link href="assets/css/' + DEMO_ADMINFLARE_VERSION + '/' + DEMO_CURRENT_THEME + '/adminflare.min.css" media="all" rel="stylesheet" type="text/css" id="adminflare-css">');
		// Include AdminFlare page stylesheet 
		document.write('<link href="assets/css/' + DEMO_ADMINFLARE_VERSION + '/pages.min.css" media="all" rel="stylesheet" type="text/css">');
	</script>
	
	
	
	<script type="text/javascript">
		window.onload = function () {
			$("input,select,textarea").not("[type=submit]").jqBootstrapValidation(
					{	
						filter: function () {
							return "0" == vue.$data.selectedMatchType;
						},
						submitSuccess: function ($form, event) {
					       var video = {
					    		   id: vue.$data.selectVideoId,
					    		   tournamentId: vue.$data.selectedTournament,
					    		   tournamentMatchId: vue.$data.selectedMatch,
					    		   name : vue.$data.selectName,
					    		   url : vue.$data.selectUrl,
					    		   displayDate: vue.$data.selectDate,
					    		   typeValue: vue.$data.selectedMatchType,
					    		   thumbnail: vue.$data.selectThumbnailURL    			  
					       }, ajaxUrl = domain + path + 'saveVideoInfo' + suffix;
					       
					       axios.post(ajaxUrl, video)
					    	  .then(function (response) {
					    	    console.log(response);
					    	    vue.$data.selectedMatch = null;
					    	    vue.$data.selectName = null;
					    	    vue.$data.selectUrl = "http://player.youku.com/embed/";
					    	    vue.$data.selectedMatchType = "0";
					    	    vue.$data.selectThumbnailURL = null;
					    	    vue.$data.selectVideoId = null;
					    	    vue.$data.thumbnailURLMessage = "";
					    	    vue.$data.submitLabel = '增加'
					    	    
					    	    vue.queryVideoList();
					    	    alert(vue.$data.mode == '' ? '视频信息增加成功！' : '视频信息修改成功！');
					    	    vue.$data.mode = '';
					    	  })
					    	  .catch(function (error) {
					    	    console.log("视频信息增加错误：", error);
					    	  });
					    }
					}
			);

			var domain = GLOBAL_VAR_DOMAIN + 'footballer/',
			    path = 'api/mobile/v2/tournament-service/',
			    suffix = '/03a68667-05dc-11e6-af3b-00163e021542/100000/e7afdd55291a3e3796a6d3d83e70d6dd',
				getTournamentListUrl = domain + path + 'getAllSportsTournament' + suffix,
				getMatchListUrl,
				tournamentList, 
			    matchList,
			    selectedTournament,
			    vue;

			vue = new Vue({
				el : '#app',
				data : {
					tournamentList: [],
					matchList : [],
					selectedTournament : "",
					selectedMatch : "",
					videoList : [],
					selectName: "",
		    	    selectUrl: '',
		    	    selectDate : '',
		    	    selectedMatchType: '',
		    	    selectThumbnailURL: '',
		    	    selectVideoId : '',
		    	    mode : '',
		    	   	submitLabel : '增加',
		    	   	thumbnailURLMessage : ''
				},
				methods : {
					queryVideoList : function() {
						if (!isNaN(this.selectedTournament)) {
							var url = domain + path + 'getVideoInfoByTournamentId' + `/${this.selectedTournament}` + suffix;
							axios.get(url).then(function (response) {
								console.log(response);
								vue.$data.videoList = response.data.videos;
							});	
						} else {
							alert("请输入联赛信息");
						}
					},
					selectOneVideo : function(video, event) {
						console.log('select video:', video);
			    		   //tournamentId: vue.$data.selectedTournament,
			    		   vue.$data.selectedMatch = video.tournamentMatchId;
			    		   vue.$data.selectName = video.name;
			    		   vue.$data.selectUrl = video.url;
			    		   vue.$data.selectDate = video.displayLongDate;
			    		   vue.$data.selectedMatchType = video.typeValue;
			    		   vue.$data.selectThumbnailURL = video.thumbnail;
			    		   vue.$data.selectVideoId = video.id;
			    		   vue.$data.mode = 'update';
			    		   vue.$data.submitLabel = '修改'
					},
					changeVideoUrl : function() {
						if (isNaN(this.selectedTournament)  || !this.selectUrl) {
							return;
						}
						this.thumbnailURLMessage = "获取缩略图 ...";
						var that = this, 
							apiUrl = domain + path + 'getThumbnailByUrl' + suffix;
							axios.post(apiUrl, {url : this.selectUrl}).then(function (response) {
							console.log(response);							
							that.thumbnailURLMessage = "获取缩略图完成！";
							that.selectThumbnailURL = response.data;
						});	
					}
				},
				watch : {
					selectedTournament : function() {
						console.log(this.selectedTournament);
						this.matchList = [];
						this.selectedMatch = "";
						this.videoList = [];
			    	    
						this.selectName = null;
			    	    this.selectUrl = "http://player.youku.com/embed/";
			    	    this.selectedMatchType = "0";
			    	    this.selectThumbnailURL = null;
			    	    this.selectVideoId = null;
			    	    this.thumbnailURLMessage = "";
			    	    this.submitLabel = '增加'

						if (!isNaN(this.selectedTournament)) {
							//ajax call
							getMatchListUrl = domain + path + 'getTournamentMatchListByTournamentId' + `/${this.selectedTournament}` + suffix;
							axios.get(getMatchListUrl).then(function (response) {
								console.log(response);
								vue.$data.matchList = response.data.list;
							});
							this.queryVideoList();
						}
					},
					selectedMatch : function() {
						var that = this,
							match = _(this.matchList).chain().filter(function(item) {
							return item.id == that.selectedMatch;
						}).first().value();
						if (match) {
							vue.$data.selectName = match.displayName;
							vue.$data.selectDate = match.displayTime;
						}
					},
					selectedMatchType : function() {
						if (isNaN(this.selectedTournament)) {
							return;
						}
						var $match = $('#match');
						if ("0" == this.selectedMatchType) {
							$match.prop('required', 'required')							
						} else {
							$match.removeAttr('required')	
						}
					}					
				},
				attached : function() {
					axios.get(getTournamentListUrl).then(function (response) {
						console.log(response);
						vue.$data.tournamentList = response.data.tournamentsList;
					});
				}
			});

			
		};
	</script>	

</head>
<body id="app" class="pages-messages" v-cloak>
<script type="text/javascript">demoSetBodyLayout();</script>
	<!-- Main navigation bar
		================================================== -->
	<header class="navbar navbar-fixed-top" id="main-navbar">
		<div class="navbar-inner">
			<div class="container">
				<a class="logo" href="#"><img alt="Af_logo" src="assets/images/af-logo.png"></a>

				<a class="btn nav-button collapsed" data-toggle="collapse" data-target=".nav-collapse">
					<span class="icon-reorder"></span>
				</a>

				<div class="nav-collapse collapse">
					<ul class="nav">
						<li class="active"><a href="#">Home</a></li>
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <i class=" icon-caret-down"></i></a>
							<ul class="dropdown-menu">
								<li><a href="#">Action</a></li>
								<li><a href="#">Another action</a></li>
								<li><a href="#">Something else here</a></li>
								<li class="divider"></li>
								<li class="nav-header">Nav header</li>
								<li><a href="#">Separated link</a></li>
								<li><a href="#">One more separated link</a></li>
							</ul>
						</li>
						<li class="divider-vertical"></li>
					</ul>
					<form class="navbar-search pull-left" action="" _lpchecked="1">
						<input type="text" class="search-query" placeholder="Search" style="width: 120px">
					</form>
					<ul class="nav pull-right">
						<li>
							<ul class="messages">
								<li>
									<a href="#"><i class="icon-warning-sign"></i> 2<span class="		responsive-text"> alerts</span></a>
								</li>
								<li>
									<a href="#"><i class="icon-envelope"></i> 25<span class="		responsive-text"> new messages</span></a>
								</li>
							</ul>
						</li>
						<li class="separator"></li>
						<li class="dropdown">
							<a href="#" class="dropdown-toggle usermenu" data-toggle="dropdown">
								<img alt="Avatar" src="assets/images/avatar.png">
								<span>&nbsp;&nbsp;Admin</span>
							</a>
							<ul class="dropdown-menu">
								<li>
									<a href="#">Profile</a>
								</li>
								<li>
									<a href="#">Settings</a>
								</li>
								<li class="divider"></li>
								<li>
									<a href="index.html">Sign In</a>
								</li>
							</ul>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</header>
	<!-- / Main navigation bar -->
	
	<!-- Left navigation panel
		================================================== -->
	<!-- / Left navigation panel -->
	
	<!-- Page content
		================================================== -->
	<section class="container">

		<section class="row-fluid">
			<div class="box">
				<div class="well">
					<form class="form-inline">
					  <label>
					  	<select placeholder="联赛" v-model="selectedTournament">
						  <option selected>请选择</option>
						  <option v-for="option in tournamentList" v-bind:value="option.id">
                          	{{option.name}}
                          </option>
						  
						</select>
					  	联赛
					  </label>					  
					  <!--  <button class="btn" v-on:click="queryVideoList">查询</button>-->
					</form>
				</div>
			</div>
		</section>
	
		<!-- ================================================== -->
		<section class="row-fluid">
			<!-- Navigation and search field
			================================================== -->
			<div class="span4">			
				<form class="row-fluid" id="validate-form" action="javascript:return;">
						<div class="control-group">
							<label class="control-label" for="match">赛事</label>
							<select id="match" placeholder="赛事" v-model="selectedMatch">
							  <option v-for="option in matchList" v-bind:value="option.id">
							    {{option.displayName}}
							  </option>
							</select>
						</div>
						
						<div class="control-group">
							<label class="control-label" for="matchType">赛事类型</label>
							<select id="matchType" required placeholder="赛事" v-model="selectedMatchType">
							  <option value="0" selected>集锦</option>
							  <option value="1">最佳</option>
							  <option value="2">花絮</option>
							  <option value="3">全场</option>
							</select>
						</div>

						<div class="control-group">
							<label class="control-label" for="name">视频名称</label>
							<div class="controls">
								<input type="text" name="name" id="name" required v-model="selectName">
							</div>
						</div>

						<div class="control-group">
							<label class="control-label" for="date">时间</label>
							<div class="controls">
								<input type="text" name="date" id="date" placeholder="2016-03-21 19:30:00" required v-model="selectDate">
							</div>
						</div>

						<div class="control-group">
							<label class="control-label" for="videoUrl">视频URL <span class="label label-success">{{thumbnailURLMessage}}</span></label>
							<div class="controls">
								<input type="text" name="videoUrl" id="videoUrl" required v-model="selectUrl" v-on:change="changeVideoUrl">
							</div>
						</div>
							
						<div class="control-group">
							<label class="control-label" for="thumbnailURL">缩略图URL</label>							
							<div class="controls">
								<input type="text" name="thumbnailURL" id="thumbnailURL" v-model="selectThumbnailURL">
								<img v-show="selectThumbnailURL" src="{{selectThumbnailURL}}" alt="缩略图" style="width:200px;height:112px;">
							</div>
							
						</div>

						<div class="form-actions" style="margin-bottom: -20px">
							<button type="submit" class="btn btn-primary">{{submitLabel}} <i class="icon-ok icon-white"></i></button><br>
						</div>
					</form>
			</div>
			<!-- / Navigation and search field -->

			<!-- ================================================== -->
			<div class="span8">
				<!-- Messages
					================================================== -->
				<!--  	
				<h3 class="box-header">
					<i class="icon-download-alt"></i>
					Inbox Messages
					<span class="pull-right">4 unread messages</span>
				</h3>
				-->
				<div class="box non-collapsible widget-messages" style="height: 400px; overflow: scroll;">
					<div class="message-actions">
						<div class="btn-group">
						</div>
						<button class="btn btn-primary btn-small pull-right">修改<i class="icon-refresh"></i></button>
					</div>

					<div class="message unread" v-for="video in videoList" v-cloak>
						<div class="action-checkbox">
							<input type="radio" name="videoGroup" v-on:change="selectOneVideo(video, $event)">
						</div>
						<a href="#" title="" class="from">{{video.name}}</a>
						<div class="from">
							{{video.displayDate}}
						</div>
						<div class="to">
							{{video.thumbnail}}
						</div>
						
					</div>

				</div>
				<!-- / Messages -->

				<!-- Pagination
					==================================================
				<div class="pagination pagination-small">
					<ul>
						<li><a href="#">Prev</a></li>
						<li><a href="#">1</a></li>
						<li><a href="#">2</a></li>
						<li><span>...</span></li>
						<li><a href="#">8</a></li>
						<li class="active"><a href="#">9</a></li>
						<li><a href="#">10</a></li>
						<li><span>...</span></li>
						<li><a href="#">32</a></li>
						<li><a href="#">33</a></li>
						<li><a href="#">Next</a></li>
					</ul>
				</div>
				 -->
				<!-- / Pagination -->
			</div>
		</section>
		
			
		<!-- Page footer
			================================================== -->
		<footer id="main-footer">
			Copyright © 2013 <a href="#">Your Company</a>, all rights reserved.
			<a href="#" class="pull-right" id="on-top-link">
				On Top &nbsp;<i class=" icon-chevron-up"></i>
			</a>
		</footer>
		<!-- / Page footer -->
	</section>
</body>
</html>